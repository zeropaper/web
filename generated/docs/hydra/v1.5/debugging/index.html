<!doctype html>
<html class="docs-version-v1.5" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.ory.sh"]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//sqa-web.ory.sh/";_paq.push(["setTrackerUrl",e+"np.php"]),_paq.push(["setSiteId","2"]);var a=document,p=a.createElement("script"),t=a.getElementsByTagName("script")[0];p.type="text/javascript",p.async=!0,p.src=e+"js/np.min.js",t.parentNode.insertBefore(p,t)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Hydra" href="/hydra/docs/opensearch.xml"><title data-react-helmet="true">Common Problems &amp; Debugging | ORY Hydra</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//hydra/docs/v1.5/debugging"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v1.5"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v1.5"><meta data-react-helmet="true" property="og:title" content="Common Problems &amp; Debugging | ORY Hydra"><meta data-react-helmet="true" name="description" content="Spec-compliant OAuth 2.0 and OpenID Connect is hard. Let&#x27;s take a look how to"><meta data-react-helmet="true" property="og:description" content="Spec-compliant OAuth 2.0 and OpenID Connect is hard. Let&#x27;s take a look how to"><link data-react-helmet="true" rel="shortcut icon" href="/hydra/docs/img/favico.png"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//hydra/docs/v1.5/debugging"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//hydra/docs/v1.5/debugging" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//hydra/docs/v1.5/debugging" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://V2EFIWEJ25-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/hydra/docs/assets/css/styles.9ac31348.css">
<link rel="preload" href="/hydra/docs/assets/js/runtime~main.0045f23e.js" as="script">
<link rel="preload" href="/hydra/docs/assets/js/main.b4bb9bff.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div id="route-identifier" data-route="/hydra/docs/v1.5/debugging"><div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">Sign up for <a href="https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53&group[17097][8]=1">important security announcements</a> and if you like ORY Hydra give it a ‚≠êÔ∏è on <a target="_blank" rel="noopener noreferrer" href="https://github.com/ory/hydra">GitHub</a>!</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Home</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ory/hydra/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/hydra/docs/v1.5/">v1.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/hydra/docs/next/">Next</a></li><li><a class="dropdown__link" href="/hydra/docs/">v1.10</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.9/">v1.9</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.8/">v1.8</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.7/">v1.7</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.6/">v1.6</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/hydra/docs/v1.5/debugging">v1.5</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.4/debugging">v1.4</a></li><li><a class="dropdown__link" href="/hydra/docs/versions">All versions</a></li></ul></div><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integrating Hydra into your stack</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/configure-deploy">Installation and Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/dependencies-environment">Database Setup and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/production">Preparing for Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hydra/docs/v1.5/debugging">Common Problems &amp; Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/advanced">Advanced Topics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/integration">Consuming OAuth 2.0</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">SDKs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Further Reading</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ORY Kratos</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ORY Oathkeeper</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ORY Keto</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->ORY Hydra<!-- --> <b>v1.5</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/hydra/docs/">latest version</a></b> (<!-- -->v1.10<!-- -->).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->v1.5</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Common Problems &amp; Debugging</h1></header><p>Spec-compliant OAuth 2.0 and OpenID Connect is hard. Let&#x27;s take a look how to
resolve certain issues.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="first-aid">First Aid<a aria-hidden="true" class="hash-link" href="#first-aid" title="Direct link to heading">‚Äã</a></h2><p>There are three things you can do to quickly debug any issue:</p><ol><li>Check the logs. ORY Hydra has extensive logging and you will find the issue
most likely in the logs. Here is an example log line for a client that
requested a redirect URL that did not match the whitelisted redirect URLS:
<code>time=&quot;2018-08-07T16:01:16Z&quot; level=error msg=&quot;An error occurred&quot; description=&quot;The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed&quot; error=invalid_request hint=&quot;The \&quot;redirect_uri\&quot; parameter does not match any of the OAuth 2.0 Client&#x27;s pre-registered redirect urls.&quot;</code></li><li>Check the URL because of two reasons:<ol><li>ORY Hydra sends <code>error_hint</code>, <code>error</code>, <code>error_description</code>, <code>error_debug</code>
in the URL. You will find the cause of the error most likely in there.</li><li>You are maybe in the wrong URL. Make sure the host and port and path is
correct. This happens often, especially when you&#x27;re just starting out and
experimenting</li></ol></li><li>Set environment variable <code>OAUTH2_EXPOSE_INTERNAL_ERRORS=true</code>. Do not do this
in production, it is possible, though unlikely, that important data leaks
with this. If set to true, ORY Hydra will set the <code>error_debug</code> query
parameter if debug information is available.</li><li>If you&#x27;re just starting out and experimenting your docker set up does not
work at all:<ol><li>Stop all containers</li><li>Remove them (unless you have something important running)</li><li>Retry. <strong>This can help a lot if you are new to this!</strong></li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="i-am-running-into-csrf-issues">I am running into CSRF issues<a aria-hidden="true" class="hash-link" href="#i-am-running-into-csrf-issues" title="Direct link to heading">‚Äã</a></h2><p>We protect the Login and Consent flows using CSRF Cookies. This mitigates
several attack vectors but can lead cause issues when misconfigured. The most
common causes of CSRF issues are the following:</p><ul><li>You are mixing domains with IP addresses in your request - for example using
<code>127.0.0.1</code> and <code>localhost</code> in the same flow.</li><li>You are running ORY Hydra via HTTP but are missing the
<code>--dangerous-force-http</code> CLI flag.</li><li>You are running the OAuth2 flow in separate browsers, or in a browser with
incognito mode. The Brave browser is also known for notoriously discarding
cookies when used in &quot;No-Tracking&quot; mode.</li><li>You are running ORY Hydra behind a Reverse Proxy (e.g. Load Balancer) that
strips the Cookie header. If the reverse proxy supports path rewrites that
might also cause issues!</li><li>You are trying to do two OAuth2 flows at the same time in the same Browser.</li><li>You have changed the Cookie SameSite behavior. If this is the default value
(you did not change it), this should not be an issue.</li></ul><p>:::warn You cannot call <code>/oauth2/auth</code> using an AJAX request. It is not allowed
and not possible with OAuth2. This endpoint can only be accessed using a normal
browser request. :::</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="logout-is-not-working-as-expected">Logout is not working as expected<a aria-hidden="true" class="hash-link" href="#logout-is-not-working-as-expected" title="Direct link to heading">‚Äã</a></h2><p>Sometimes, calling <code>/oauth2/sessions/logout</code> does not behave as expected, for
example:</p><ul><li>An error occurs.</li><li>You are being redirected directly to the post_logout_redirect_uri instead of
the logout UI.</li></ul><p>First of all, there are two types of logout requests - one is called &quot;OP (OpenID
Provider) Initiated&quot; and one &quot;RP (Relying Party) Initiated&quot;. The first flow MUST
NEITHER contain the <code>id_token_hint</code>, nor a <code>state</code>, nor
<code>post_logout_redirect_uri</code>.</p><p>If no active authentication session is set at ORY Hydra, the browser will be
redirected immediately to the system-wide configured post logout redirect URI.</p><p>An active session may be missing because:</p><ul><li>You are mixing up domain names (e.g. 127.0.0.1 and localhost - <strong>this is a
common mistake</strong>)</li><li>You are running ORY Hydra behind a proxy that messes with Cookies</li><li>You are using a Browser with a very strict privacy policy which makes it
difficult or impossible for ORY Hydra to properly set cookies. We&#x27;ve observed
that the <strong>Brave Browser</strong> is very, very difficult here.</li><li>You did not set <code>remember: true</code> when accepting the login request</li></ul><p><strong>Before filing a bug report, make sure you actually have a cookie named
<code>oauth2_authentication_session</code> for the URL ORY Hydra is running on, and
especially for the domain that&#x27;s in your <code>http://.../oauth2/sessions/logout</code></strong></p><p>If <code>id_token_hint</code> is set, you may define both <code>state</code> and
<code>post_logout_redirect_uri</code>. The same problems can cause this flow to behave
unexpectedly as listed above, with the only difference that now ORY Hydra knows
who the user to be logged out is (from the <code>id_token_hint</code>) and if any
Front-/Back-channel Logout is configured for that client, it will be executed
even if there is no valid authentication session for that user in ORY Hydra.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="openid-connect-id-token-missing">OpenID Connect ID Token missing<a aria-hidden="true" class="hash-link" href="#openid-connect-id-token-missing" title="Direct link to heading">‚Äã</a></h2><p>If you expect an OAuth 2.0 ID Token but are not receiving one, this can have
multiple reasons:</p><ol><li>You are using the <code>client_credentials</code> grant which can not return an ID
token.</li><li>You forgot to request the <code>openid</code> scope when calling
<code>/oauth2/auth?response_type=code</code> (Authorize Code Flow - correct would be
<code>/oauth2/auth?response_type=code&amp;scope=openid</code>) or the <code>id_token</code> response
type when calling <code>/oauth2/auth?response_type=token</code> (Implicit/Hybrid flow -
correct would be <code>/oauth2/auth?response_type=token+id_token&amp;scope=openid</code> or
any other combination such as <code>response_type=id_token</code>,
<code>response_type=token+code+id_token</code>).</li><li>You consent app did not send <code>granted_scope: [&quot;openid&quot;]</code> or when accepting
the consent request.</li><li>The OAuth 2.0 Client making the request is not allowed to request the scope
<code>openid</code>.</li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="oauth-20-refresh-token-is-missing">OAuth 2.0 Refresh Token is missing<a aria-hidden="true" class="hash-link" href="#oauth-20-refresh-token-is-missing" title="Direct link to heading">‚Äã</a></h2><p>If you expect an OAuth 2.0 Refresh Token but are not receiving one, this can
have multiple reasons:</p><ol><li>You are using an implicit or hybrid flow. These flows never return a refresh
token!</li><li>You are using the <code>client_credentials</code> grant which can not return a refresh
token.</li><li>You forgot to request the <code>offline</code> or <code>offline_access</code> scope when calling
<code>/oauth2/auth</code>.</li><li>You consent app did not send <code>granted_scope: [&quot;offline&quot;]</code> or
<code>granted_scope: [&quot;offline_access&quot;]</code> when accepting the consent request.</li><li>The OAuth 2.0 Client making the request is not allowed to request the scope
<code>openid</code>.</li></ol><h2 class="anchor anchorWithStickyNavbar_31ik" id="oauth-20-authorize-code-flow-fails">OAuth 2.0 Authorize Code Flow fails<a aria-hidden="true" class="hash-link" href="#oauth-20-authorize-code-flow-fails" title="Direct link to heading">‚Äã</a></h2><p>The most likely cause is misconfiguration, summarized in the next sections.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="wrong-or-misconfigured-oauth-20-client">Wrong or misconfigured OAuth 2.0 Client<a aria-hidden="true" class="hash-link" href="#wrong-or-misconfigured-oauth-20-client" title="Direct link to heading">‚Äã</a></h3><p>You are using the wrong OAuth 2.0 Client or the OAuth 2.0 Client has a broken
configuration. To check that you&#x27;re using the right client, run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">hydra clients get --endpoint http://ory-hydra &lt;the-client-id&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The result shows you the whole client (excluding its secret). Check that the
values are correct. Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;client_id&quot;: &quot;my-client&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;grant_types&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;authorization_code&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;jwks&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;redirect_uris&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;http://127.0.0.1:5556/callback&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;response_types&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;code&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;scope&quot;: &quot;openid offline&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;subject_type&quot;: &quot;pairwise&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;token_endpoint_auth_method&quot;: &quot;client_secret_basic&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;userinfo_signed_response_alg&quot;: &quot;none&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="redirect-url-is-not-whitelisted">Redirect URL is not whitelisted<a aria-hidden="true" class="hash-link" href="#redirect-url-is-not-whitelisted" title="Direct link to heading">‚Äã</a></h3><p>A likely cause of your request failing is that you are using the wrong redirect
URL. Assuming your OAuth 2.0 URL looks like
<code>http://ory-hydra/oauth2/auth?client_id=my-client&amp;...&amp;redirect_uri=http://my-url/callback</code></p><p>The redirect URL <code>http://my-url/callback</code> must be whitelisted in your client
configuration. The URLs must match <strong>exactly</strong>. URL <code>http://my-url/callback</code> and
<code>http://my-url/callback?foo=bar</code> are different URLs!</p><p>To see the whitelisted redirect_uris, check the client:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">hydra clients get --endpoint http://ory-hydra &lt;the-client-id&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;redirect_uris&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;http://127.0.0.1:5556/callback&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here you see that <code>http://my-url/callback</code> is not in the list, which is why the
request fails.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="oauth-20-client-id-and-secret-are-sent-in-body-instead-of-header">OAuth 2.0 Client ID and secret are sent in body instead of header<a aria-hidden="true" class="hash-link" href="#oauth-20-client-id-and-secret-are-sent-in-body-instead-of-header" title="Direct link to heading">‚Äã</a></h3><p>There are multiple ways of authenticating OAuth 2.0 Clients at the
<code>/oauth2/token</code>:</p><ul><li>HTTP Basic Authorization (<code>client_secret_basic</code>) - the OAuth 2.0 Client ID and
secret are sent in the HTTP Header (<code>Authorization: basic ....</code>)</li><li>HTTP Body (<code>client_secret_post</code>) - the OAuth 2.0 Client ID and secret are sent
in the POST body (<code>Content-Type: application/x-www-form-urlencoded</code>)</li></ul><p>Both are valid schemes. But the OAuth 2.0 Client has to be configured to allow
either of the one. Per default, the OAuth 2.0 Client allows HTTP Basic
Authorization only. You can check which method is allowed:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">hydra clients get --endpoint http://ory-hydra &lt;the-client-id&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;token_endpoint_auth_method&quot;: &quot;client_secret_basic&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see, this client is allowed to authorize using HTTP Basic
Authorization. If you try to authorize with the client credentials in the POST
body, the authentication process will fail. To allow a client to perform the
POST authorization scheme, you must set
<code>&quot;token_endpoint_auth_method&quot;: &quot;client_secret_post&quot;</code>. You can do this in the CLI
with the <code>--token-endpoint-auth-method</code> flag.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="distributed-tracing">Distributed Tracing<a aria-hidden="true" class="hash-link" href="#distributed-tracing" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="what-is-this">What is this?<a aria-hidden="true" class="hash-link" href="#what-is-this" title="Direct link to heading">‚Äã</a></h3><p>Configuring Distributed Tracing (DT) will enable you to obtain a visualization
of the call paths that take place in order to process a request made to Hydra.
It&#x27;s yet another tool that you can use to aid you in profiling, debugging and
ultimately understanding your deployment of Hydra better. Hydra currently
supports the following tracing options:</p><ul><li>Tracing backend(s): Jaeger - <em>Note: adding support for other
<a href="https://opentracing.io/docs/supported-tracers" target="_blank" rel="noopener noreferrer">opentracing compliant backends</a>
is planned. To aid in priority, please
<a href="https://github.com/ory/hydra/issues" target="_blank" rel="noopener noreferrer">create an issue</a> with your feature
request.</em></li><li>Following existing traces: If you have deployed Hydra behind a proxy that has
initiated a trace, Hydra will attempt to join that trace by examining the
request headers for tracing context.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="what-a-hydra-trace-includes">What a Hydra trace includes<a aria-hidden="true" class="hash-link" href="#what-a-hydra-trace-includes" title="Direct link to heading">‚Äã</a></h3><p>In DT speak, a trace is comprised of one or more spans which are logical units
of work. Each Hydra span is encapsulated with the following state:</p><ul><li>A name</li><li>A start time</li><li>A finish time</li><li>A set of zero or more tags</li></ul><p>Hydra currently creates the following spans:</p><ul><li>Top level span (<em>named after the request path</em>) for the requested endpoint.
Span tags: - http method - http status code - error IFF status code &gt;= 400</li><li>Child span will be created if bcrypt (<em>e.g. when the token endpoint is
called</em>) is called. Span tags: - bcrypt work factor</li><li>All SQL database interactions. Spans/tags will vary depending on the database
driver used.</li></ul><p>This is still evolving and subject to change as tracing support continues to
expand in Hydra. If you see something that is missing/wrong, please create an
issue.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="alright-how-can-i-set-this-up-locally">Alright, how can I set this up locally?<a aria-hidden="true" class="hash-link" href="#alright-how-can-i-set-this-up-locally" title="Direct link to heading">‚Äã</a></h3><p>The
<a href="https://github.com/ory/hydra/blob/master/quickstart-tracing.yml" target="_blank" rel="noopener noreferrer">provided docker-compose file</a>
in the project repository has tracing configuration w/ jaeger added which you
can use to play around with. Simply uncomment the configurations associated with
tracing as so:</p><p><strong>Under the Hydra service definition <code>depends_on</code> configs, uncomment the
following:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">- jaeger</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Under the Hydra service definition <code>environment</code> configs, uncomment the
following:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">- TRACING_PROVIDER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TRACING_PROVIDER_JAEGER_SAMPLING_SERVER_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TRACING_PROVIDER_JAEGER_LOCAL_AGENT_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TRACING_PROVIDER_JAEGER_SAMPLING_TYPE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TRACING_PROVIDER_JAEGER_SAMPLING_VALUE</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Uncomment the Jaeger service definition:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">jaeger:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: jaegertracing/all-in-one:1.7.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;5775:5775/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;6831:6831/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;6832:6832/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;5778:5778&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;16686:16686&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;14268:14268&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;9411:9411&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then simply run <code>docker-compose up</code>. Grab a coffee or stretch while you wait for
everything to come up. You will then be able to navigate to the Jaeger UI which
you have exposed on port <code>16686</code> at http://localhost:16686/search. You can now
start making requests to Hydra and inspect traces!</p><p>As an example, here is a trace created by making a bad request to the
<code>POST /clients</code> endpoint:</p><img alt="Sample Trace" src="/hydra/docs/images/docs/hydra/sample_trace.png">;<p>At a glance, you are able to see that:</p><ul><li>The request failed</li><li>The request took ~80ms</li><li>It resulted in a 409</li><li>The hash comparison to validate the client&#x27;s credentials took a whopping 70ms.
Bcrypt is expensive!</li><li>The various database operations performed</li></ul><p><em>Note: in order to see spans around database interactions, you must be using a
SQL backend (i.e. MySQL or Postgres).</em></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="tracing-configurations">Tracing configurations<a aria-hidden="true" class="hash-link" href="#tracing-configurations" title="Direct link to heading">‚Äã</a></h3><p>The CLI will provide you with the list of Hydra tracing configurations and their
supported values. Simply run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it hydra_hydra_1 hydra serve --help</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And read the section on <code>DEBUG CONTROLS</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ory/hydra/edit/master/docs/versioned_docs/version-v1.5/debugging.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2020-06-16T15:14:10.000Z">6/16/2020</time></b> by <b>aeneasr</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/hydra/docs/v1.5/production"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->Preparing for Production</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/hydra/docs/v1.5/advanced"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Advanced Topics<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#first-aid" class="table-of-contents__link toc-highlight">First Aid</a></li><li><a href="#i-am-running-into-csrf-issues" class="table-of-contents__link toc-highlight">I am running into CSRF issues</a></li><li><a href="#logout-is-not-working-as-expected" class="table-of-contents__link toc-highlight">Logout is not working as expected</a></li><li><a href="#openid-connect-id-token-missing" class="table-of-contents__link toc-highlight">OpenID Connect ID Token missing</a></li><li><a href="#oauth-20-refresh-token-is-missing" class="table-of-contents__link toc-highlight">OAuth 2.0 Refresh Token is missing</a></li><li><a href="#oauth-20-authorize-code-flow-fails" class="table-of-contents__link toc-highlight">OAuth 2.0 Authorize Code Flow fails</a><ul><li><a href="#wrong-or-misconfigured-oauth-20-client" class="table-of-contents__link toc-highlight">Wrong or misconfigured OAuth 2.0 Client</a></li><li><a href="#redirect-url-is-not-whitelisted" class="table-of-contents__link toc-highlight">Redirect URL is not whitelisted</a></li><li><a href="#oauth-20-client-id-and-secret-are-sent-in-body-instead-of-header" class="table-of-contents__link toc-highlight">OAuth 2.0 Client ID and secret are sent in body instead of header</a></li></ul></li><li><a href="#distributed-tracing" class="table-of-contents__link toc-highlight">Distributed Tracing</a><ul><li><a href="#what-is-this" class="table-of-contents__link toc-highlight">What is this?</a></li><li><a href="#what-a-hydra-trace-includes" class="table-of-contents__link toc-highlight">What a Hydra trace includes</a></li><li><a href="#alright-how-can-i-set-this-up-locally" class="table-of-contents__link toc-highlight">Alright, how can I set this up locally?</a></li><li><a href="#tracing-configurations" class="table-of-contents__link toc-highlight">Tracing configurations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright ¬© 2021 ORY GmbH</div></div></div></footer></div></div>
<script src="/hydra/docs/assets/js/runtime~main.0045f23e.js"></script>
<script src="/hydra/docs/assets/js/main.b4bb9bff.js"></script>
<noscript><p><img src="//sqa-web.ory.sh/np.php?idsite=2&amp;rec=1" style="border:0;" alt=""></p></noscript></body>
</html>