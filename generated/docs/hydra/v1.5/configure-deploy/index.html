<!doctype html>
<html class="docs-version-v1.5" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.ory.sh"]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//sqa-web.ory.sh/";_paq.push(["setTrackerUrl",e+"np.php"]),_paq.push(["setSiteId","2"]);var a=document,p=a.createElement("script"),t=a.getElementsByTagName("script")[0];p.type="text/javascript",p.async=!0,p.src=e+"js/np.min.js",t.parentNode.insertBefore(p,t)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Hydra" href="/hydra/docs/opensearch.xml"><title data-react-helmet="true">Installation and Setup | ORY Hydra</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//hydra/docs/v1.5/configure-deploy"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v1.5"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v1.5"><meta data-react-helmet="true" property="og:title" content="Installation and Setup | ORY Hydra"><meta data-react-helmet="true" name="description" content="The goal of this chapter is to introduce you to a fully functional set up that"><meta data-react-helmet="true" property="og:description" content="The goal of this chapter is to introduce you to a fully functional set up that"><link data-react-helmet="true" rel="shortcut icon" href="/hydra/docs/img/favico.png"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//hydra/docs/v1.5/configure-deploy"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//hydra/docs/v1.5/configure-deploy" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//hydra/docs/v1.5/configure-deploy" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/hydra/docs/assets/css/styles.6c26e9f2.css">
<link rel="preload" href="/hydra/docs/assets/js/runtime~main.a2e9f361.js" as="script">
<link rel="preload" href="/hydra/docs/assets/js/main.bed6794d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div id="route-identifier" data-route="/hydra/docs/v1.5/configure-deploy"><div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">Sign up for <a href="https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53&group[17097][8]=1">important security announcements</a> and if you like ORY Hydra give it a ‚≠êÔ∏è on <a target="_blank" rel="noopener noreferrer" href="https://github.com/ory/hydra">GitHub</a>!</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/hydra/docs/img/logo-hydra.svg" alt="ORY Hydra" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Home</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ory/hydra/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/ory/hydra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/hydra/docs/v1.5/">v1.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/hydra/docs/next/configure-deploy">Next</a></li><li><a class="dropdown__link" href="/hydra/docs/configure-deploy">v1.10</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.9/configure-deploy">v1.9</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.8/configure-deploy">v1.8</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.7/configure-deploy">v1.7</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.6/configure-deploy">v1.6</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/hydra/docs/v1.5/configure-deploy">v1.5</a></li><li><a class="dropdown__link" href="/hydra/docs/v1.4/configure-deploy">v1.4</a></li><li><a class="dropdown__link" href="/hydra/docs/versions">All versions</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integrating Hydra into your stack</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hydra/docs/v1.5/configure-deploy">Installation and Setup</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/dependencies-environment">Database Setup and Configuration</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/production">Preparing for Production</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/debugging">Common Problems &amp; Debugging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/advanced">Advanced Topics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/hydra/docs/v1.5/integration">Consuming OAuth 2.0</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">SDKs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Further Reading</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ORY Kratos</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ORY Oathkeeper</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ORY Keto</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for ORY Hydra <b>v1.5</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/hydra/docs/configure-deploy">latest version</a></b> (v1.10).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: v1.5</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Installation and Setup</h1></header><p>The goal of this chapter is to introduce you to a fully functional set up that
includes ORY Hydra as well as our User Login &amp; Consent Provider reference
implementation.</p><p>The goal of this section is to familiarize you with the specifics of setting up
ORY Hydra in your environment. Before starting with this section, please check
out the <a href="/hydra/docs/v1.5/5min-tutorial">tutorial</a>. It will teach you the most important
flows and settings for Hydra.</p><p>This guide will:</p><ol><li>Download and run a PostgreSQL container in Docker.</li><li>Download and run ORY Hydra in Docker.</li><li>Download and run our reference User Login &amp; Consent Provider.</li><li>Create an OAuth 2.0 Client to perform the OAuth 2.0 Authorize Code Flow.</li><li>Perform the OAuth 2.0 Authorize Code flow.</li></ol><p>Before starting with this guide, please install the most recent version of
<a href="https://www.docker.com/community-edition#/download" target="_blank" rel="noopener noreferrer">Docker</a>. While docker is
not required for running ORY Hydra, we recommend using it for this tutorial as
it will greatly reduce the complexity of setting up a database on your system
without virtualization, installing Go, and compiling ORY Hydra.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="create-a-network"></a>Create a Network<a class="hash-link" href="#create-a-network" title="Direct link to heading">#</a></h2><p>Before we can start, a network must be created which we will attach all our
Docker containers to. That way, the containers can talk to one another.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker network create hydraguide</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="deploy-postgresql"></a>Deploy PostgreSQL<a class="hash-link" href="#deploy-postgresql" title="Direct link to heading">#</a></h2><p>For the purpose of this tutorial, we will use PostgreSQL as a database. As you
probably already know, don&#x27;t run databases in Docker in production! For the sake
of this tutorial however, let&#x27;s use Docker to quickly deploy the database.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name ory-hydra-example--postgres </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_USER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">hydra </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">secret </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">POSTGRES_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">hydra </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d postgres:9.6</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This command wil start a postgres instance with name
<code>ory-hydra-example--postgres</code>, set up a database called <code>hydra</code> and create a
user <code>hydra</code> with password <code>secret</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="deploy-ory-hydra"></a>Deploy ORY Hydra<a class="hash-link" href="#deploy-ory-hydra" title="Direct link to heading">#</a></h2><p>We highly recommend using Docker to run Hydra, as installing, configuring and
running Hydra is easiest with Docker. ORY Hydra is available on
<a href="https://hub.docker.com/r/oryd/hydra/" target="_blank" rel="noopener noreferrer">Docker Hub</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># The system secret can only be set against a fresh database. Key rotation is currently not supported. This</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># secret is used to encrypt the database and needs to be set to the same value every time the process (re-)starts.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># You can use /dev/urandom to generate a secret. But make sure that the secret must be the same anytime you define it.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># You could, for example, store the value somewhere.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">SECRETS_SYSTEM</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">export</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">LC_CTYPE</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">C</span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> /dev/urandom </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tr</span><span class="token variable" style="color:#36acaa"> -dc </span><span class="token variable string" style="color:#e3116c">&#x27;a-zA-Z0-9&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">fold</span><span class="token variable" style="color:#36acaa"> -w </span><span class="token variable number" style="color:#36acaa">32</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Alternatively you can obviously just set a secret:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># $ export SECRETS_SYSTEM=this_needs_to_be_the_same_always_and_also_very_$3cuR3-._</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The database url points us at the postgres instance. This could also be an ephermal in-memory database (`export DSN=memory`)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># or a MySQL URI.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DSN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">postgres://hydra:secret@ory-hydra-example--postgres:5432/hydra?sslmode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">disable</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Before starting, let&#x27;s pull the latest ORY Hydra tag from docker.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker pull oryd/hydra:v1.5.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This command will show you all the environment variables that you can set. Read this carefully.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># It is the equivalent to `hydra help serve`.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -it --rm --entrypoint hydra oryd/hydra:v1.5.2 </span><span class="token builtin class-name">help</span><span class="token plain"> serve</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Starts all HTTP/2 APIs and connects to a database backend.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ORY Hydra does not do magic, it requires conscious decisions, for example running SQL migrations which is required</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># when installing a new version of ORY Hydra, or upgrading an existing installation.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># It is the equivalent to `hydra migrate sql --yes postgres://hydra:secret@ory-hydra-example--postgres:5432/hydra?sslmode=disable`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -it --rm </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  oryd/hydra:v1.5.2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  migrate sql --yes </span><span class="token variable" style="color:#36acaa">$DSN</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Applying </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">client</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> SQL migrations</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Migration successful</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Let&#x27;s run the server (settings explained below):</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name ory-hydra-example--hydra </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">9000</span><span class="token plain">:4444 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">9001</span><span class="token plain">:4445 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">SECRETS_SYSTEM</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$SECRETS_SYSTEM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">DSN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$DSN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">URLS_SELF_ISSUER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://localhost:9000/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">URLS_CONSENT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http://localhost:9020/consent </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">URLS_LOGIN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http://localhost:9020/login </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  oryd/hydra:v1.5.2 serve all</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># And check if it&#x27;s running:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker logs ory-hydra-example--hydra</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-29T21:26:26Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Connecting with postgres://*:*@postgres:5432/hydra?sslmode=disable&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-29T21:26:26Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Connected to SQL!&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-29T21:26:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Setting up http server on :4444&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s dive into the various settings:</p><ul><li><code>--network hydraguide</code> connects this instance to the network and makes it
possible to connect to the PostgreSQL database.</li><li><code>-p 9000:4444</code> exposes ORY Hydra&#x27;s public API on <code>https://localhost:9000/</code>.</li><li><code>-p 9001:4445</code> exposes ORY Hydra&#x27;s administrative API on
<code>https://localhost:9001/</code>.</li><li><code>-e SECRETS_SYSTEM=$SECRETS_SYSTEM</code> sets the system secret environment
variable <strong>(required)</strong>.</li><li><code>-e DSN=$DSN</code> sets the database url environment variable <strong>(required)</strong>.</li><li><code>-e URLS_SELF_ISSUER=https://localhost:9000/</code> this value must be set to the
publicly available URL of ORY Hydra <strong>(required)</strong>.</li><li><code>-e URLS_CONSENT=http://localhost:9020/consent</code> this sets the URL of the
consent provider <strong>(required)</strong>. We will set up the service that handles
requests at that URL in the next sections.</li><li><code>-e URLS_LOGIN=http://localhost:9020/login</code> this sets the URL of the login
provider <strong>(required)</strong>. We will set up the service that handles requests at
that URL in the next sections.</li></ul><p>Note: In this example we did not define a value for the optional setting
<code>OAUTH2_ERROR_URL</code>. This URL can be used to provide an endpoint which will
receive error messages from ORY Hydra that should be displayed to the end user.
The URL receives <code>error</code> and <code>error_description</code> parameters. If this value is
not set, Hydra uses the fallback endpoint <code>/oauth2/fallbacks/error</code> and displays
a default error message. In order to obtain a uniform UI, you might want to
include such an endpoint in your login or consent provider.</p><p>To confirm that the instance is running properly,
<a href="https://localhost:9001/health/ready" target="_blank" rel="noopener noreferrer">open the health check</a>. If asked, accept
the self signed certificate in your browser. You should simply see <code>ok</code>.</p><p>On start up, ORY Hydra is initializing some values. Let&#x27;s take a look at the
logs:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker logs ory-hydra-example--hydra</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-30T09:06:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Connecting with postgres://*:*@postgres:5432/hydra?sslmode=disable&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-30T09:06:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Connected to SQL!&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-30T09:06:34Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Key pair for signing hydra.openid.id-token is missing. Creating new one.&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-30T09:06:41Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">warning </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;No TLS Key / Certificate for HTTPS found. Generating self-signed certificate.&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2017-06-30T09:06:41Z&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info </span><span class="token assign-left variable" style="color:#36acaa">msg</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Setting up http server on :4444&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see, the following steps are performed when running ORY Hydra against
a fresh database:</p><ol><li>If no system secret was given (in our case we provided one), a random one is
generated and emitted to the logs. Note this down, otherwise you won&#x27;t be
able to restart Hydra.</li><li>Cryptographic keys are generated for the OpenID Connect ID Token, the consent
challenge and response, and TLS encryption using a self-signed certificate,
which is why we need to run all commands using <code>--skip-tls-verify</code>.</li></ol><p>ORY Hydra can be managed using the Hydra Command Line Interface (CLI), which is
using ORY Hydra&#x27;s REST APIs. To see the available commands, run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run --rm -it --entrypoint hydra oryd/hydra:v1.5.2 </span><span class="token builtin class-name">help</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Hydra is a cloud native high throughput OAuth2 and OpenID Connect provider</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  hydra </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="deploy-login--consent-app"></a>Deploy Login &amp; Consent App<a class="hash-link" href="#deploy-login--consent-app" title="Direct link to heading">#</a></h2><p>The Login Provider and Consent Provider can be two separate web services. We
provide a
<a href="https://github.com/ory/hydra-login-consent-node" target="_blank" rel="noopener noreferrer">reference implementation</a>
which combines both features in one app. Here, we will use deploy that app using
Docker.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker pull oryd/hydra-login-consent-node:v1.3.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -d </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name ory-hydra-example--consent </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">9020</span><span class="token plain">:3000 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">HYDRA_ADMIN_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://ory-hydra-example--hydra:4445 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">NODE_TLS_REJECT_UNAUTHORIZED</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  oryd/hydra-login-consent-node:v1.3.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Let&#x27;s check if it&#x27;s running ok:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker logs ory-hydra-example--consent</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s take a look at the arguments:</p><ul><li><code>-p 9020:3000</code> exposes this service at port 9020. If you remember, that&#x27;s the
port of the <code>URLS_CONSENT</code> and <code>URLS_LOGIN</code> value from the ORY Hydra docker
container (<code>URLS_CONSENT=http://localhost:9020/consent</code>,
<code>URLS_LOGIN=http://localhost:9020/login</code>).</li><li><code>HYDRA_ADMIN_URL=http://hydra:4445</code> point to the ORY Hydra Administrative API.</li><li><code>NODE_TLS_REJECT_UNAUTHORIZED=0</code> disables TLS verification, because we are
using self-signed certificates.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="perform-oauth-20-flow"></a>Perform OAuth 2.0 Flow<a class="hash-link" href="#perform-oauth-20-flow" title="Direct link to heading">#</a></h2><p>Great! Our infrastructure is all set up! Next it&#x27;s time to perform the OAuth 2.0
Authorize Code flow. For that purpose, the ORY Hydra CLI has a feature that sets
up an OAuth 2.0 Consumer and an OAuth 2.0 callback URL. Typically, this would be
a third-party application that requests access to a user&#x27;s resources on your
servers - for example a Facebook App you wrote that backs up a user&#x27;s photos and
thus requires read access to the user&#x27;s photos.</p><p>Before we go ahead, the OAuth 2.0 Client that performs the request has to be set
up. Let&#x27;s call the client <code>facebook-photo-backup</code>. We have to specify which
OAuth 2.0 Grant Types, OAuth 2.0 Scope, OAuth 2.0 Response Types, and Callback
URLs the client may request:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run --rm -it </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:#36acaa">HYDRA_ADMIN_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://ory-hydra-example--hydra:4445 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  oryd/hydra:v1.5.2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  clients create --skip-tls-verify </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --id facebook-photo-backup </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --secret some-secret </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --grant-types authorization_code,refresh_token,client_credentials,implicit </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --response-types token,code,id_token </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --scope openid,offline,photos.read </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --callbacks http://127.0.0.1:9010/callback</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Client facebook-photo-backup</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Client Secret: some-secret</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s dive into some of the arguments:</p><ul><li><code>--skip-tls-verify</code> is supported by all management commands
(create/delete/update/... OAuth 2.0 Client, JSON Web Key, ...) and tells the
CLI to trust any certificate authority - even self-signed ones. We need this
flag because the server uses a self-signed certificate. In production
deployments, you would use a certificate signed by a trusted CA.</li><li><code>--grant-types authorize_code,refresh_token,client_credentials,implicit</code> we
want to be able to perform all of these OAuth 2.0 flows.</li><li><code>--response-types token,code,id_token</code> allows us to receive authorize codes,
access and refresh tokens, and OpenID Connect ID Tokens.</li><li><code>--scope openid,offline,photos.read</code> allows the client to request various
permissions:<ul><li><code>openid</code> allows the client to perform the OpenID Connect flow and request an
OpenID Connect ID Token.</li><li><code>offline</code> allows the client to request a refresh token. Because we want to
continuously backup photos, the app must be able to refresh expired access
tokens. This scope allows that.</li><li><code>photos.read</code> this is an imaginary scope that is not handled by ORY Hydra
but serves the purpose of making it clear that we could request read access
to a user&#x27;s photos. You can obviously omit this scope or use your own scope.</li></ul></li><li><code>--callbacks http://localhost:9010/callback</code> allows the client to request this
redirect uri.</li></ul><p>Perfect, let&#x27;s perform an exemplary OAuth 2.0 Authorize Code Flow! To make this
easy, the ORY Hydra CLI provides a helper command called <code>hydra token user</code>.
Just imagine this being, for example, passport.js that is generating an auth
code url, redirecting the browser to it, and then exchanging the authorize code
for an access token. The same thing happens with this command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run --rm -it </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network hydraguide </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p </span><span class="token number" style="color:#36acaa">9010</span><span class="token plain">:9010 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  oryd/hydra:v1.5.2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  token user --skip-tls-verify </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --port </span><span class="token number" style="color:#36acaa">9010</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --auth-url https://localhost:9000/oauth2/auth </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --token-url https://ory-hydra-example--hydra:4444/oauth2/token </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --client-id facebook-photo-backup </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --client-secret some-secret </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --scope openid,offline,photos.read</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting up callback listener on http://localhost:9010/callback</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Press ctrl + c on Linux / Windows or cmd + c on OSX to end the process.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">If your browser does not </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"> automatically, navigate to:</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        https://localhost:9010/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>open the link, as prompted, in your browser, and follow the steps shown there.
You might encounter a screen like the following one:</p><img alt="Insecure connection" src="/hydra/docs/images/docs/hydra/insecure-connection.png">;<p>This happens because we run ORY Hydra with a self-signed TLS certificate. In
production deployments, you would probably use a certificate signed by a trusted
CA and not see this screen.</p><p>When you see this screen, click on &quot;Advanced&quot; and &quot;Add Exception&quot; to continue.
In some browsers, this might work differently, but it&#x27;s always possible to
proceed.</p><p>When completed, you should land at a screen that looks like this one:</p><img alt="OAuth 2.0 result" src="/hydra/docs/images/docs/hydra/install-result.png">;</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ory/hydra/edit/master/docs/versioned_docs/version-v1.5/configure-deploy.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated on <b><time datetime="2020-08-07T12:34:03.000Z">8/7/2020</time></b> by <b>aeneasr</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/hydra/docs/v1.5/case-study"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ OAuth 2.0 Case Study</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/hydra/docs/v1.5/dependencies-environment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Database Setup and Configuration ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-network" class="table-of-contents__link">Create a Network</a></li><li><a href="#deploy-postgresql" class="table-of-contents__link">Deploy PostgreSQL</a></li><li><a href="#deploy-ory-hydra" class="table-of-contents__link">Deploy ORY Hydra</a></li><li><a href="#deploy-login--consent-app" class="table-of-contents__link">Deploy Login &amp; Consent App</a></li><li><a href="#perform-oauth-20-flow" class="table-of-contents__link">Perform OAuth 2.0 Flow</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright ¬© 2021 ORY GmbH</div></div></div></footer></div></div>
<script src="/hydra/docs/assets/js/runtime~main.a2e9f361.js"></script>
<script src="/hydra/docs/assets/js/main.bed6794d.js"></script>
<noscript><p><img src="//sqa-web.ory.sh/np.php?idsite=2&amp;rec=1" style="border:0;" alt=""></p></noscript></body>
</html>