<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.415a7973f">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.ory.sh"]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//sqa-web.ory.sh/";_paq.push(["setTrackerUrl",e+"np.php"]),_paq.push(["setSiteId","2"]);var a=document,p=a.createElement("script"),t=a.getElementsByTagName("script")[0];p.type="text/javascript",p.async=!0,p.src=e+"js/np.js",t.parentNode.insertBefore(p,t)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Kratos" href="/kratos/docs/opensearch.xml"><title data-react-helmet="true">Data Mapping with Jsonnet | ORY Kratos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Data Mapping with Jsonnet | ORY Kratos"><meta data-react-helmet="true" name="description" content="Some modules like the"><meta data-react-helmet="true" property="og:description" content="Some modules like the"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//kratos/docs/next/reference/jsonnet"><link data-react-helmet="true" rel="shortcut icon" href="/kratos/docs/img/favico.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//kratos/docs/next/reference/jsonnet"><link rel="stylesheet" href="/kratos/docs/styles.6a49189e.css">
<link rel="preload" href="/kratos/docs/styles.0f6093cf.js" as="script">
<link rel="preload" href="/kratos/docs/runtime~main.c9f94d93.js" as="script">
<link rel="preload" href="/kratos/docs/main.aea70f51.js" as="script">
<link rel="preload" href="/kratos/docs/2.64b8b869.js" as="script">
<link rel="preload" href="/kratos/docs/3.500f9747.js" as="script">
<link rel="preload" href="/kratos/docs/18b93cb3.2044413c.js" as="script">
<link rel="preload" href="/kratos/docs/1be78505.f14a9397.js" as="script">
<link rel="preload" href="/kratos/docs/371.01cd6a3b.js" as="script">
<link rel="preload" href="/kratos/docs/b8d7c5e6.0a81c9c2.js" as="script">
<link rel="preload" href="/kratos/docs/935f2afb.f6e3aa37.js" as="script">
<link rel="preload" href="/kratos/docs/370.c3526b33.js" as="script">
<link rel="preload" href="/kratos/docs/98fbf3c4.fb8bdf4e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/kratos/docs/">Docs</a><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ecosystem</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat</a><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/kratos/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/kratos/docs/next/reference/jsonnet">Next</a></li><li><a class="dropdown__link" href="/kratos/docs/reference/jsonnet">v0.5</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.4/reference/jsonnet">v0.4</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.3/reference/jsonnet">v0.3</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.2/">v0.2</a></li><li><a class="dropdown__link" href="/kratos/docs/v0.1/">v0.1</a></li><li><a class="dropdown__link" href="/kratos/docs/versions">All versions</a></li></ul></div><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/kratos/docs/">Docs</a></li><li class="menu__list-item"><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Ecosystem</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="menu__link">Forum</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Chat</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/kratos/docs/next/reference/jsonnet">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/reference/jsonnet">v0.5</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.4/reference/jsonnet">v0.4</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.3/reference/jsonnet">v0.3</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.2/">v0.2</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/v0.1/">v0.1</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/versions">All versions</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for ORY Kratos <strong>Next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/kratos/docs/reference/jsonnet">latest version</a></strong> (v0.5).</div></div><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_Oumm">Data Mapping with Jsonnet</h1></header><div class="markdown"><p>Some modules like the
<a href="/kratos/docs/next/concepts/credentials/openid-connect-oidc-oauth2">OpenID Connect and OAuth2 Method</a>
support <a href="https://jsonnet.org" target="_blank" rel="noopener noreferrer">Jsonnet</a>, allowing you to easily write code that
modifies your identity&#x27;s data and load it into ORY Kratos.</p><p>We highly recommend checking out the official
<a href="https://jsonnet.org/learning/tutorial.html" target="_blank" rel="noopener noreferrer">learning Jsonnet tutorial</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="formatting-jsonnet-code"></a>Formatting Jsonnet Code<a class="hash-link" href="#formatting-jsonnet-code" title="Direct link to heading">#</a></h2><p>Format Jsonnet code snippets using:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ kratos </span><span class="token builtin class-name">help</span><span class="token plain"> jsonnet </span><span class="token function" style="color:#d73a49">format</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># e.g.:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">$ kratos jsonnet </span><span class="token function" style="color:#d73a49">format</span><span class="token plain"> --write path/to/files/*.jsonnet</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="linting-jsonnet-code"></a>Linting Jsonnet Code<a class="hash-link" href="#linting-jsonnet-code" title="Direct link to heading">#</a></h2><p>Lint Jsonnet code snippets using:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ kratos </span><span class="token builtin class-name">help</span><span class="token plain"> jsonnet lint</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># e.g.:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">$ kratos jsonnet lint path/to/files/*.jsonnet</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The command will exit with an exit code of <code>1</code> and print all found lint errors
to stderr if the code snippet has lint issues.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="testing-jsonnet-code"></a>Testing Jsonnet Code<a class="hash-link" href="#testing-jsonnet-code" title="Direct link to heading">#</a></h2><p>This is an anticipated future feature. For progress check out
<a href="https://github.com/ory/kratos/issues/391" target="_blank" rel="noopener noreferrer">kratos#391</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="tips--tricks"></a>Tips &amp; Tricks<a class="hash-link" href="#tips--tricks" title="Direct link to heading">#</a></h2><p>The purpose of this section is to provide you with examples for common use
cases.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="optionality"></a>Optionality<a class="hash-link" href="#optionality" title="Direct link to heading">#</a></h3><p>When you&#x27;re unsure that a field will be set in the <code>claims</code> variable use the
following to make the trait field also optional:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-jsonnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">local claims = std.extVar(&#x27;claims&#x27;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  identity: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    traits: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      email: claims.sub,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      [if &quot;website&quot; in claims then &quot;website&quot; else null]: claims.website,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="defaults"></a>Defaults<a class="hash-link" href="#defaults" title="Direct link to heading">#</a></h3><p>Set defaults for the <code>claims</code> variable:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-jsonnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">local claims = {</span></div><div class="token-line" style="color:#393A34"><span class="token plain"> website: &#x27;i am the default website value&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">} + std.extVar(&#x27;claims&#x27;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  identity: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    traits: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      website: claims.website</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="raising-errors"></a>Raising Errors<a class="hash-link" href="#raising-errors" title="Direct link to heading">#</a></h3><p>You can raise errors in the Jsonnet code. Keep in mind that these will be shown
as system errors, not validation errors, and that the user will end up at the
Error UI!</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-jsonnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">local claims = std.extVar(&#x27;claims&#x27;);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">if std.length(claims.sub) == 0 then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  error &#x27;claim sub not set&#x27;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    identity: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      traits: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // ...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/kratos/edit/master/docs/docs/reference/jsonnet.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-09-01T13:03:37.000Z" class="docLastUpdatedAt_1Qna">9/1/2020</time> by <strong>aeneasr</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#formatting-jsonnet-code" class="table-of-contents__link">Formatting Jsonnet Code</a></li><li><a href="#linting-jsonnet-code" class="table-of-contents__link">Linting Jsonnet Code</a></li><li><a href="#testing-jsonnet-code" class="table-of-contents__link">Testing Jsonnet Code</a></li><li><a href="#tips--tricks" class="table-of-contents__link">Tips &amp; Tricks</a><ul><li><a href="#optionality" class="table-of-contents__link">Optionality</a></li><li><a href="#defaults" class="table-of-contents__link">Defaults</a></li><li><a href="#raising-errors" class="table-of-contents__link">Raising Errors</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 ORY GmbH</div></div></div></footer></div>
<script src="/kratos/docs/styles.0f6093cf.js"></script>
<script src="/kratos/docs/runtime~main.c9f94d93.js"></script>
<script src="/kratos/docs/main.aea70f51.js"></script>
<script src="/kratos/docs/2.64b8b869.js"></script>
<script src="/kratos/docs/3.500f9747.js"></script>
<script src="/kratos/docs/18b93cb3.2044413c.js"></script>
<script src="/kratos/docs/1be78505.f14a9397.js"></script>
<script src="/kratos/docs/371.01cd6a3b.js"></script>
<script src="/kratos/docs/b8d7c5e6.0a81c9c2.js"></script>
<script src="/kratos/docs/935f2afb.f6e3aa37.js"></script>
<script src="/kratos/docs/370.c3526b33.js"></script>
<script src="/kratos/docs/98fbf3c4.fb8bdf4e.js"></script>
<noscript><p><img src="//sqa-web.ory.sh/np.php?idsite=2&amp;rec=1" style="border:0;" alt=""></p></noscript></body>
</html>