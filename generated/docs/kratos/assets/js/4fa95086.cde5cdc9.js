(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[62948],{58215:function(e,t,n){"use strict";var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,i=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:i},t)}},26396:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var a=n(87462),i=n(67294),r=n(72389),s=n(79443);var o=function(){var e=(0,i.useContext)(s.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},l=n(89521),c=n(86010),d="tabItem_1uMI";function u(e){var t,n,a,r=e.lazy,s=e.block,u=e.defaultValue,p=e.values,m=e.groupId,h=e.className,f=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=p?p:f.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),v=(0,l.lx)(g,(function(e,t){return e.value===t.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var w=null===u?u:null!=(t=null!=u?u:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=f[0])?void 0:a.props.value;if(null!==w&&!g.some((function(e){return e.value===w})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+w+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var b=o(),k=b.tabGroupChoices,y=b.setTabGroupChoices,N=(0,i.useState)(w),x=N[0],T=N[1],R=[],E=(0,l.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var C=k[m];null!=C&&C!==x&&g.some((function(e){return e.value===C}))&&T(C)}var F=function(e){var t=e.currentTarget,n=R.indexOf(t),a=g[n].value;a!==x&&(E(t),T(a),null!=m&&y(m,a))},S=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=R.indexOf(e.currentTarget)+1;n=R[a]||R[0];break;case"ArrowLeft":var i=R.indexOf(e.currentTarget)-1;n=R[i]||R[R.length-1]}null==(t=n)||t.focus()};return i.createElement("div",{className:"tabs-container"},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,c.Z)("tabs",{"tabs--block":s},h)},g.map((function(e){var t=e.value,n=e.label;return i.createElement("li",{role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,className:(0,c.Z)("tabs__item",d,{"tabs__item--active":x===t}),key:t,ref:function(e){return R.push(e)},onKeyDown:S,onFocus:F,onClick:F},null!=n?n:t)}))),r?(0,i.cloneElement)(f.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):i.createElement("div",{className:"margin-vert--md"},f.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function p(e){var t=(0,r.Z)();return i.createElement(u,(0,a.Z)({key:String(t)},e))}},79443:function(e,t,n){"use strict";var a=(0,n(67294).createContext)(void 0);t.Z=a},88821:function(e,t,n){"use strict";var a=n(67294);t.Z=function(){return a.createElement("div",{className:"admonition admonition-warning alert alert--danger"},a.createElement("div",{className:"admonition-heading"},a.createElement("h5",null,a.createElement("span",{className:"admonition-icon"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},a.createElement("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),a.createElement("div",{className:"admonition-content"},a.createElement("p",null,"Never use API flows to implement Browser applications! Using API flows in Single-Page-Apps as well as server-side apps opens up several potential attack vectors, including Login and other CSRF attacks.")))}},12669:function(e,t,n){"use strict";var a=n(26396),i=n(58215),r=n(67294),s=n(19055),o=n(52387),l=n(25108),c=function(e){var t=e.item;return t.code?(l.warn(t.code,"asfd"),r.createElement(s.Z,{className:"language-"+t.language,children:t.code})):t.image?r.createElement("img",{src:t.image,alt:t.alt}):t.codeFromRemote?r.createElement(o.Z,{language:t.language,link:t.codeFromRemote.link,src:t.codeFromRemote.src}):r.createElement("span",null,"Unknown item type: $",JSON.stringify(t))};t.Z=function(e){var t=e.items;return r.createElement(a.Z,{defaultValue:Object.keys(t)[0],values:Object.keys(t).map((function(e){return{label:t[e].label,value:e}}))},Object.keys(t).map((function(e){return r.createElement(i.Z,{key:e,value:e},r.createElement(c,{item:t[e]}))})))}},56368:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var a=n(26396),i=n(58215),r=n(67294),s=n(52387),o=n.p+"assets/images/browser-61597c2d37644d2e9a6cd62143a17d19.png",l=n.p+"assets/images/browser-3fffa4ddf3b8dbaa9171845af0b1ace3.png",c=n.p+"assets/images/browser-95c5fd81e495c104256cf0460ebd835a.png",d=n.p+"assets/images/browser-22673e53b8fd2d5b86732105f965b818.png",u=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},p=function(e){var t,n=e.flow;switch(n){case"registration":t=r.createElement("img",{src:c,alt:"User Registration HTML Form"});break;case"login":t=r.createElement("img",{src:o,alt:"User Login HTML Form"});break;case"settings":t=r.createElement("img",{src:l,alt:"Profile Settings HTML Form"});break;case"recovery":t=r.createElement("img",{src:d,alt:"Account Recovery HTML Form"});break;case"verification":t=r.createElement("img",{src:d,alt:"Email Verification HTML Form"})}return r.createElement(a.Z,{defaultValue:"browser",values:[{label:"Browser UI",value:"browser"},{label:"Golang (API Flow)",value:"golang"},{label:"ExpressJS",value:"express"},{label:"ReactJS",value:"react"},{label:"React Native",value:"react-native"}]},r.createElement(i.Z,{value:"browser"},t),r.createElement(i.Z,{value:"express"},r.createElement(s.Z,{lang:"js",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/src/routes/"+n+".ts",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/src/routes/"+n+".ts"}),"The views can be rather simple, as Ory Kratos provides you with all the information you need for rendering the forms. The following examples use Handlebars and a generic form generator to render the Flow:",r.createElement(a.Z,{defaultValue:"view",values:[{label:u(n)+" View",value:"view"},{label:"Generic Form View",value:"generic-form"},{label:"Example Input Form Element",value:"input-form"}]},r.createElement(i.Z,{value:"view"},r.createElement(s.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/"+n+".hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/"+n+".hbs"})),r.createElement(i.Z,{value:"generic-form"},r.createElement(s.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/ui.hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/ui.hbs"})),r.createElement(i.Z,{value:"input-form"},r.createElement(s.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/ui_node_input_default.hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/ui_node_input_default.hbs"}))),"The rest of the form partials can be found"," ",r.createElement("a",{href:"https://github.com/ory/kratos-selfservice-ui-node/tree/master/views/partials"},"here"),"."),r.createElement(i.Z,{value:"react"},"A React example is currently in the making."),r.createElement(i.Z,{value:"golang"},r.createElement(s.Z,{lang:"tsx",link:"https://github.com/ory/kratos/blob/master/examples/go/selfservice/"+n+"/main.go.tsx",src:"https://raw.githubusercontent.com/ory/kratos/master/examples/go/selfservice/"+n+"/main.go"}),"The rest of the code examples partials can be found"," ",r.createElement("a",{href:"https://github.com/ory/kratos/blob/master/examples"},"here")),r.createElement(i.Z,{value:"react-native"},r.createElement(s.Z,{lang:"tsx",link:"https://github.com/ory/kratos-selfservice-ui-react-native/blob/master/src/components/Routes/"+u(n)+".tsx",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-react-native/master/src/components/Routes/"+u(n)+".tsx"}),"The views can be rather simple, as Ory Kratos provides you with all the information you need for rendering the forms.",r.createElement(a.Z,{defaultValue:"generic-form",values:[{label:"Generic Form View",value:"generic-form"},{label:"Example Input Form Element",value:"input-form"}]},r.createElement(i.Z,{value:"generic-form"},r.createElement(s.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-react-native/blob/master/src/components/Form/Form.tsx",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-react-native/master/src/components/Form/Form.tsx"})),r.createElement(i.Z,{value:"input-form"},r.createElement(s.Z,{lang:"handlebars",link:"https://github.com/ory/kratos-selfservice-ui-react-native/blob/master/src/components/Form/Field.tsxs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-react-native/master/src/components/Form/Field.tsx"}))),"The rest of the form partials can be found"," ",r.createElement("a",{href:"https://github.com/ory/kratos-selfservice-ui-react-native/tree/master/src"},"here")))}},52387:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(67294),i=n(83300),r=n.n(i),s=n(19055),o="container_2x1S",l=n(25108),c=function(e,t){if(!e)return 0;var n=t.findIndex((function(t){return t.indexOf(e)>-1}));return-1===n?0:n},d=function(e){var t=e.src,n=e.title,i=(0,a.useState)(""),d=i[0],u=i[1];(0,a.useEffect)((function(){var n,a,i;r()(t.replace("github.com","raw.githubusercontent.com").replace("/blob/","/")).then((function(e){return e.text()})).then((n=e,a=n.startAt,i=n.endAt,function(e){var t=e.split("\n"),n=c(a,t);n>0&&(t=["// ..."].concat(t.slice(n,-1)));var r=c(i,t);return r>0&&(t=[].concat(t.slice(0,r+1),["// ..."])),t.join("\n")})).then(u).catch(l.error)}),[]);var p="language-"+function(e){var t=e.split(".").pop();switch(t){case"jsx":return"jsx";case"tsx":return"tsx";case"ts":return"typescript";case"go":return"go";case"yaml":case"yml":return"yaml";case"js":return"javascript";case"html":return"html";case"pug":return"pug";default:return t}}(t),m='title="'+(n||function(e){var t=e.match(new RegExp("https://github.com/[^/]+/[^/]+/blob/[^/]+/(.+)","i"))||[];return t.length>=2?t[1]:e}(t))+'"';return a.createElement("div",{className:o},a.createElement(s.Z,{metastring:m,className:p,children:d}))}},59079:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(67294),i=n(21140),r=n.n(i),s="graph_1lrJ",o="pointer_3d8u",l="overlay_2fuY",c="visible_2Z3U",d="backdrop_2z5L",u=n(94184),p=n.n(u);r().initialize({startOnLoad:!0,logLevel:"fatal",securityLevel:"strict",arrowMarkerAbsolute:!1,theme:"neutral",flowchart:{useMaxWidth:!0,htmlLabels:!0,rankSpacing:65,nodeSpacing:30,curve:"basis"},sequence:{useMaxWidth:!0},gantt:{useMaxWidth:!0}});var m=function(e){var t,n=e.chart,i=(0,a.useState)(!1),u=i[0],m=i[1],h=(0,a.useState)(void 0),f=h[0],g=h[1],v=(0,a.useState)("mermaid-"+Math.random().toString(36).substr(2,-1))[0],w=function(){return m(!u)};return(0,a.useEffect)((function(){r().render(v,n,(function(e){g(e)}))}),[]),a.createElement(a.Fragment,null,a.createElement("div",{onClick:w,className:p()(s,o),dangerouslySetInnerHTML:{__html:f}}),a.createElement("div",{onClick:w,className:p()(l,o,s,(t={},t[c]=u,t))},a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:p()(d,s),dangerouslySetInnerHTML:{__html:f}})))}},19582:function(e,t,n){"use strict";var a=n(67294),i=n(59079);t.Z=function(e){return a.createElement(i.Z,{chart:(t=e,n=t.flows,r=void 0===n?["login","registration","settings","..."]:n,s=t.interactions,o=void 0===s?['"Log in"','"Sign Up"','"Update Email"',"..."]:s,l=t.success,c=void 0===l?"Perform flow-specific action (e.g. create user, set session cookie, ...)":l,d=r.length>1?"<"+r.join("|")+">":""+r.join("|"),"\nsequenceDiagram\n  participant B as API Client\n  participant K as Ory Kratos\n\n  B->>K: REST GET /self-service/"+d+"/api\n  K--\x3e>K: Create and store new "+r.join(", ")+" flow\n  K->>B: HTTP 200 OK with flow as application/json payload\n  B--\x3e>B: Render form using e.g. Native iOS UI Elements\n  B--\x3e>B: User fills out forms, clicks e.g. "+o+"\n  B->>K: REST POST to e.g. /self-service/"+d+"?flow=...>\n  K--\x3e>K: Validates and processes payload\n  alt Form payload is valid\n    K->>B: "+c+"\n  else Form payload invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K->>B: Respond with e.g. HTTP 400 Bad Request and updated flow as payload\n    B--\x3e>B: Render form and validation errors using e.g. Native iOS UI Elements\n    B--\x3e>K: Repeat flow with input data, submit, validate, ...\n  end\n")});var t,n,r,s,o,l,c,d}},64923:function(e,t,n){"use strict";var a=n(67294),i=n(59079);t.Z=function(e){return a.createElement(a.Fragment,null,a.createElement(i.Z,{chart:(t=e,n=t.flows,r=void 0===n?["login","registration","settings","..."]:n,s=t.interactions,o=void 0===s?['"Log in"','"Sign Up"','"Update Email"',"..."]:s,l=t.success,c=void 0===l?"Perform flow-specific action (e.g. create user, set session cookie, ...)":l,d=r.length>1?"<"+r.join("|")+">":""+r.join("|"),"\nsequenceDiagram\n\n  participant B as Browser\n  participant K as Ory Kratos\n  participant A as Flow UI\n\n  B->>K: Follow link to /self-service/"+d+"/browser\n  K--\x3e>K: Create and store new "+r.join(", ")+" flow\n  K->>B: HTTP 302 Found <selfservice.flows."+d+".ui_url>?flow=<flow-id>\n\n  B->>A: Opens <selfservice.flows.<"+r.join("|")+">.ui_url>?flow=<flow-id>\n  A--\x3e>K: Fetches data to render forms using /selfservice/"+d+"/flows?id=<flow-id>\n  B--\x3e>A: Fills out forms, clicks e.g. "+o.join(", ")+"\n  B->>K: Submits form\n  K--\x3e>K: Validates and processes form payloads\n\n  alt Form payload is valid\n    K->>B: "+c+"\n  else Form payload invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K--\x3e>B: HTTP 302 Found <selfservice.flows."+d+".ui_url>?flow=<flow-id>\n    B->>A: Opens <selfservice.flows."+d+"?flow=<flow-id>\n    A--\x3e>K: Fetches data to render form fields and errors\n    B->>K: Repeat flow with input data, submit, validate, ...\n  end\n")}),a.createElement("p",null,"The ",a.createElement("em",null,"Flow UI")," (",a.createElement("strong",null,"your application!"),') is responsible for rendering the actual Login and Registration HTML Forms. You can of course implement one app for rendering all the Login, Registration, ... screens, and another app (think "Service Oriented Architecture", "Micro-Services" or "Service Mesh") is responsible for rendering your Dashboards, Management Screens, and so on.'));var t,n,r,s,o,l,c,d}},25881:function(e,t,n){"use strict";n.r(t),n.d(t,{contentTitle:function(){return y},default:function(){return R},frontMatter:function(){return k},metadata:function(){return N},toc:function(){return x}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),s=n(59079),o=n(88821),l=n(52387),c=n(64923),d=n(19582),u=n(12669),p={curl:{label:"Raw HTTP",language:"shell",code:n(18456).Z},js:{label:"JavaScript SDK",language:"js",code:n(34339).Z},go:{label:"Go SDK",language:"go",code:n(75413).Z}},m={curl:{label:"Raw HTTP",language:"shell",code:n(45400).Z},html:{label:"HTML",language:"html",code:n(97469).Z},jsx:{label:"ReactJS",language:"js",code:n(21310).Z},node:{label:"ExpressJS",language:"html",code:n(78604).Z},angular:{label:"Angular",language:"js",code:n(93844).Z}},h={curl:{label:"Raw HTTP",language:"shell",code:n(25362).Z},js:{label:"JavaScript",language:"js",code:n(17929).Z},go:{label:"Go",language:"go",code:n(31295).Z}},f={browser:{label:"Browser UI",image:n(89159).Z,alt:"User Registration HTML Form with validation errors"},missing:{label:"Missing Email",language:"shell",code:n(12437).Z},wrong:{label:"Password Policy Violation",language:"shell",code:n(7681).Z}},g={browser:{label:"Browser UI",image:n(31980).Z,alt:"User Registration HTML Form with missing or invalid fields when performing an OpenID Connect flow"},missing:{label:"Missing Website",language:"shell",code:n(33995).Z}},v={missing:{label:"Missing ID Token",language:"shell",code:n(19006).Z}},w=n(56368),b=["components"],k={id:"user-registration",title:"User Registration"},y=void 0,N={unversionedId:"self-service/flows/user-registration",id:"version-v0.6/self-service/flows/user-registration",isDocsHomePage:!1,title:"User Registration",description:"initBrowserFlow,",source:"@site/versioned_docs/version-v0.6/self-service/flows/user-registration.mdx",sourceDirName:"self-service/flows",slug:"/self-service/flows/user-registration",permalink:"/kratos/docs/v0.6/self-service/flows/user-registration",editUrl:"https://github.com/ory/kratos/edit/master/docs/versioned_docs/version-v0.6/self-service/flows/user-registration.mdx",tags:[],version:"v0.6",lastUpdatedBy:"aeneasr",lastUpdatedAt:1619690398,formattedLastUpdatedAt:"4/29/2021",frontMatter:{id:"user-registration",title:"User Registration"},sidebar:"version-v0.6/docs",previous:{title:"Concepts and Overview",permalink:"/kratos/docs/v0.6/self-service"},next:{title:"User Login",permalink:"/kratos/docs/v0.6/self-service/flows/user-login"}},x=[{value:"Initialize Registration Flow",id:"initialize-registration-flow",children:[{value:"Registration for Browser Clients",id:"registration-for-browser-clients",children:[],level:3},{value:"Registration for API Clients",id:"registration-for-api-clients",children:[],level:3}],level:2},{value:"Registration Form Payloads",id:"registration-form-payloads",children:[{value:"Registration with Username/Email and password",id:"registration-with-usernameemail-and-password",children:[],level:3},{value:"Registration with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0",id:"registration-with-google-facebook-github--openid-connect--oauth-20",children:[],level:3}],level:2},{value:"Registration Flow Form Rendering",id:"registration-flow-form-rendering",children:[],level:2},{value:"Registration Form Validation",id:"registration-form-validation",children:[{value:"Registration with Username/Email and Password",id:"registration-with-usernameemail-and-password-1",children:[],level:3},{value:"Registration with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0",id:"registration-with-google-facebook-github--openid-connect--oauth-20-1",children:[],level:3}],level:2},{value:"Successful Registration",id:"successful-registration",children:[{value:"Browser Clients",id:"browser-clients",children:[{value:"With Auto-Login on Registration",id:"with-auto-login-on-registration",children:[],level:4}],level:3},{value:"API Clients",id:"api-clients",children:[{value:"With Auto-Login on Registration",id:"with-auto-login-on-registration-1",children:[],level:4}],level:3}],level:2},{value:"Hooks",id:"hooks",children:[],level:2}],T={toc:x};function R(e){var t=e.components,n=(0,i.Z)(e,b);return(0,r.kt)("wrapper",(0,a.Z)({},T,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Please read the ",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/self-service"},"Self-Service Flows")," overview before\ncontinuing with this document. It is also advised to run the\n",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/quickstart"},"quickstart")," locally as example URLs and payloads have\nbeen generated with it."))),(0,r.kt)("p",null,"There are two Registration Flow types supported in Ory Kratos:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Flows where the user sits in front of the Browser (e.g. website, single page\napp, ...)"),(0,r.kt)("li",{parentName:"ul"},"Flows where API interaction is required (e.g. mobile app, Smart TV, ...)")),(0,r.kt)("p",null,"The Registration Flow can be summarized as the following state machine:"),(0,r.kt)(s.Z,{chart:'\nstateDiagram\n  s1: Flow is initialized\n  s2: Execute Before Registration Hook(s)\n  s3: User Interface renders Registration Flow Forms\n  s4: Execute After Registration Hook(s)\n  s5: Update Registration Flow with Error Context(s)\n  s6: Registration successful\n\t[*] --\x3e s1 : User clicks "Sign up"\n  s1 --\x3e s2\n  s2 --\x3e Error : A hook fails\n  s2 --\x3e s3\n  s3 --\x3e s4 : User provides valid registration data\n  s3 --\x3e s5 : User provides invalid registration data\n  s5 --\x3e s3\n  s4 --\x3e Error : A hook fails\n  s4 --\x3e s6\n  s6 --\x3e [*]\n  Error --\x3e [*]\n',mdxType:"Mermaid"}),(0,r.kt)("p",null,"Currently, two registration methods are supported:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"password")," for signing up with an email / username and password;"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"oidc")," for signing up using a social sign in provider such as Google or\nFacebook (check out the\n",(0,r.kt)("a",{parentName:"li",href:"/kratos/docs/v0.6/guides/sign-in-with-github-google-facebook-linkedin"},"set up guide"),").")),(0,r.kt)("p",null,"Both are dis/enabled in the Ory Kratos config:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/my/kratos/config.yml"',title:'"path/to/my/kratos/config.yml"'},"selfservice:\n  methods:\n    password:\n      enabled: true\n    oidc:\n      enabled: true\n      # ...\n")),(0,r.kt)("h2",{id:"initialize-registration-flow"},"Initialize Registration Flow"),(0,r.kt)("p",null,"The first step is to initialize the Registration Flow. This allows\npre-registration hooks to run, set up Anti-CSRF tokens, and more."),(0,r.kt)("h3",{id:"registration-for-browser-clients"},"Registration for Browser Clients"),(0,r.kt)("p",null,"The Registration Flow for browser clients relies on HTTP redirects between Ory\nKratos, your Registration UI, and the end-user's browser:"),(0,r.kt)(c.Z,{flows:["registration"],success:"User created and successful HTTP 302 redirect",interactions:['"Sign up"'],mdxType:"SelfServiceBrowserFlow"}),(0,r.kt)("p",null,"To initialize the Registration Flow, point the Browser to the initialization\nendpoint:"),(0,r.kt)(u.Z,{items:m,mdxType:"CodeTabs"}),(0,r.kt)("p",null,"The server responds with a HTTP 302 redirect to the Registration UI, appending\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"?flow=<flow-id>")," query parameter (see the curl example) to the URL\nconfigured here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/config/kratos.yml"',title:'"path/to/config/kratos.yml"'},"selfservice:\n  flows:\n    registration:\n      # becomes http://127.0.0.1:4455/auth/registration?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3\n      ui_url: http://127.0.0.1:4455/auth/registration\n")),(0,r.kt)("h3",{id:"registration-for-api-clients"},"Registration for API Clients"),(0,r.kt)(o.Z,{mdxType:"ApiWarning"}),(0,r.kt)("p",null,"The Registration Flow for API clients does not use HTTP Redirects and can be\nsummarized as follows:"),(0,r.kt)(d.Z,{flows:["registration"],success:"User created and HTTP 200 OK response",interactions:['"Sign in"'],mdxType:"SelfServiceApiFlow"}),(0,r.kt)("p",null,"To initialize the API flow, the client calls the API-flow initialization\nendpoint\n(",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/reference/api#initialize-registration-flow-for-api-clients"},"REST API Reference"),")\nwhich returns a JSON response:"),(0,r.kt)(u.Z,{items:h,mdxType:"CodeTabs"}),(0,r.kt)("h2",{id:"registration-form-payloads"},"Registration Form Payloads"),(0,r.kt)("p",null,"Fetching the Registration Flow\n(",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/reference/api#get-registration-flow"},"REST API Reference"),") is usually\nonly required for browser clients but also works for Registration Flows\ninitialized by API clients. All you need is a valid Registration Flow ID:"),(0,r.kt)(u.Z,{items:p,mdxType:"CodeTabs"}),(0,r.kt)("h3",{id:"registration-with-usernameemail-and-password"},"Registration with Username/Email and password"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Before you start")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Please read the\n",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/concepts/credentials/username-email-password"},"Username / Email & Password Credentials Documentation"),"\nfirst."))),(0,r.kt)("p",null,"When the ",(0,r.kt)("inlineCode",{parentName:"p"},"password")," method is enabled, it will be part of the ",(0,r.kt)("inlineCode",{parentName:"p"},"methods")," payload\nin the Registration Flow. Ory Kratos uses the Identity JSON Schema defined in\n",(0,r.kt)("inlineCode",{parentName:"p"},"identity.default_schema_url")," to generate a list of form fields and add it to\nthe Registration Flow. Assuming we are using the Identity JSON Schema from the\nQuickstart"),(0,r.kt)(l.Z,{language:"json",link:"https://github.com/ory/kratos/blob/master/contrib/quickstart/kratos/email-password/identity.schema.json",src:"https://raw.githubusercontent.com/ory/kratos/master/contrib/quickstart/kratos/email-password/identity.schema.json",mdxType:"CodeFromRemote"}),(0,r.kt)("p",null,"the response would look as such:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'$ curl -H "Accept: application/json" -s \\\n    \'http://127.0.0.1:4434/self-service/registration/flows?id=388ae8da-4c44-4765-bfa8-669963d388f5\' | jq\n\n{\n  "id": "388ae8da-4c44-4765-bfa8-669963d388f5",\n  "type": "browser",\n  "expires_at": "2021-04-28T09:29:23.713785401Z",\n  "issued_at": "2021-04-28T09:19:23.713785401Z",\n  "request_url": "http://127.0.0.1:4433/self-service/registration/browser",\n  "ui": {\n    "action": "http://127.0.0.1:4433/self-service/registration?flow=388ae8da-4c44-4765-bfa8-669963d388f5",\n    "method": "POST",\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "Z9pXCAGz2oK/9Ch8x4U1ehEAKHWVngQTPFDFTlYtbK8lWzXRyDBnl3neZGUIgW44ewDjb5niFdGGM5GERhu01g==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "traits.email",\n          "type": "email",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "E-Mail",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "password",\n          "type": "password",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070001,\n            "text": "Password",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "traits.name.first",\n          "type": "text",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "First Name",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "traits.name.last",\n          "type": "text",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "Last Name",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "value": "password",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1040001,\n            "text": "Sign up",\n            "type": "info",\n            "context": {}\n          }\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h3",{id:"registration-with-google-facebook-github--openid-connect--oauth-20"},"Registration with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Before you start")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Check out the\n",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/guides/sign-in-with-github-google-facebook-linkedin"},"Sign in with GitHub, Google, ... Guide"),"\nand learn how to set up this method!"))),(0,r.kt)("p",null,"The Social Sign Up Method (",(0,r.kt)("inlineCode",{parentName:"p"},"oidc"),") enables you to use"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://github.com/"},"GitHub"),";"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.apple.com/sign-in-with-apple/"},"Apple"),";"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/integration/openid_connect_provider.html"},"GitLab"),";"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/identity/sign-in/web/sign-in"},"Google"),";"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.facebook.com/docs/facebook-login/"},"Facebook"),";"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.ory.sh/hydra"},"Ory Hydra"),";"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.keycloak.org"},"Keycloak"),";"),(0,r.kt)("li",{parentName:"ul"},"and every other OpenID Connect Certified Provider")),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Social Sign Up is currently not possible for API Clients. It will be possible in\na future version, which is partially tracked as\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ory/kratos/issues/273"},"kratos#273")))),(0,r.kt)("p",null,"If enabled, the method contains an ",(0,r.kt)("inlineCode",{parentName:"p"},"oidc")," key with the configured sign in\nproviders as submit fields:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'$ curl -H "Accept: application/json" -s \\\n  \'http://127.0.0.1:4433/self-service/registration/flows?id=c1f4dfd1-3559-4cd3-b6f6-4a83689a41bd\' | jq\n\n{\n  "id": "c1f4dfd1-3559-4cd3-b6f6-4a83689a41bd",\n  "type": "browser",\n  "expires_at": "2021-04-28T10:25:35.011063Z",\n  "issued_at": "2021-04-28T09:25:35.011063Z",\n  "request_url": "http://127.0.0.1:4433/self-service/registration/browser",\n  "ui": {\n    "action": "http://127.0.0.1:4455/self-service/registration?flow=c1f4dfd1-3559-4cd3-b6f6-4a83689a41bd",\n    "method": "POST",\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "PJO66RnYyYLyksS/bjlveGnmZARtqPvibgJI/0EX3DPZf0Oq0Ln+5KtTHVfcxMDSbXjx32hU9GwpfbwA2eLFWA==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "oidc",\n        "attributes": {\n          "name": "provider",\n          "type": "submit",\n          "value": "github",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1040002,\n            "text": "Sign up with github",\n            "type": "info",\n            "context": {\n              "provider": "github"\n            }\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "oidc",\n        "attributes": {\n          "name": "provider",\n          "type": "submit",\n          "value": "google",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1040002,\n            "text": "Sign up with google",\n            "type": "info",\n            "context": {\n              "provider": "google"\n            }\n          }\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h2",{id:"registration-flow-form-rendering"},"Registration Flow Form Rendering"),(0,r.kt)("p",null,"The Registration User Interface is a route (page / site) in your application\n(server, native app, single page app) that should render a registration form."),(0,r.kt)("p",null,"In stark contrast to other Identity Systems, Ory Kratos does not render this\nHTML. Instead, you need to implement the HTML code in your application (e.g.\nNodeJS + ExpressJS, Java, PHP, ReactJS, ...), which gives you extreme\nflexibility and customizability in your user interface flows and designs."),(0,r.kt)("p",null,"You will use the Registration Flow JSON response to render the registration form\nUI, which could looks as follows depending on your programming language and web\nframework:"),(0,r.kt)(w.Z,{flow:"registration",mdxType:"RenderFlow"}),(0,r.kt)("h2",{id:"registration-form-validation"},"Registration Form Validation"),(0,r.kt)("p",null,"The form payloads are then submitted to Ory Kratos which follows up with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An HTTP 302 Found redirect pointing to the Registration UI for Browser\nClients."),(0,r.kt)("li",{parentName:"ul"},"An ",(0,r.kt)("inlineCode",{parentName:"li"},"application/json")," response for API Clients.")),(0,r.kt)("h3",{id:"registration-with-usernameemail-and-password-1"},"Registration with Username/Email and Password"),(0,r.kt)("p",null,"To complete the registration process, the end-user fills out the form which must\ninclude a field marked as the identifier\n(",(0,r.kt)("inlineCode",{parentName:"p"},"ory.sh/kratos.credentials.password.identifier: true"),") in the Identity JSON\nSchema, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},' {\n   "$id": "https://schemas.ory.sh/presets/kratos/quickstart/email-password/identity.schema.json",\n   "$schema": "http://json-schema.org/draft-07/schema#",\n   "title": "Person",\n   "type": "object",\n   "properties": {\n     "traits": {\n       "type": "object",\n       "properties": {\n         "email": {\n           "type": "string",\n           "format": "email",\n+          "ory.sh/kratos": {\n+            "credentials": {\n+              "password": {\n+                "identifier": true\n+              }\n+            }\n+          }\n         }\n       },\n       "required": [\n         "email"\n       ],\n       "additionalProperties": false\n     }\n   }\n }\n')),(0,r.kt)("p",null,"If the registration payload is invalid (e.g. the password does not match the\npassword policy, the email is missing, ...), the password method includes the\nvalidation errors:"),(0,r.kt)(u.Z,{items:f,mdxType:"CodeTabs"}),(0,r.kt)("p",null,"When validation errors happen, browser clients receive a HTTP 302 Found redirect\nto the Registration Flow UI, containing the Registration Flow ID which includes\nthe error payloads."),(0,r.kt)("p",null,"For API Clients, the server typically responds with HTTP 400 Bad Request and the\nRegistration Flow in the response payload as JSON."),(0,r.kt)("h3",{id:"registration-with-google-facebook-github--openid-connect--oauth-20-1"},"Registration with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0"),(0,r.kt)("p",null,"Completing the ",(0,r.kt)("inlineCode",{parentName:"p"},"oidc")," method requires the user to go through an OAuth 2.0 or\nOpenID Connect flow which involves logging into the upstream identity provider\n(e.g. Google) and giving consent."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If the user has already sign up with the given provider before, the user will\nsimply be logged in and no new Ory Kratos Identity will be created."))),(0,r.kt)("p",null,"A possible validation error is a missing ID Token:"),(0,r.kt)(u.Z,{items:v,mdxType:"CodeTabs"}),(0,r.kt)("p",null,"What may also happen is that the Ory Kratos Identity Schema JSON includes a\nfield which is required but was not provided by the upstream identity provider\n(e.g. Google). In those cases, the end-user's browser is returned to the\nregistration screen with the form validation errors."),(0,r.kt)("p",null,"Let's assume the Ory Kratos Identity Schema JSON requires a ",(0,r.kt)("inlineCode",{parentName:"p"},"website")," trait"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},' {\n   "$id": "https://schemas.ory.sh/presets/kratos/quickstart/email-password/identity.schema.json",\n   "$schema": "http://json-schema.org/draft-07/schema#",\n   "title": "Person",\n   "type": "object",\n   "properties": {\n     "traits": {\n       "type": "object",\n       "properties": {\n         "email": {\n           "type": "string",\n           "format": "email",\n           "ory.sh/kratos": {\n             "credentials": {\n               "password": {\n                 "identifier": true\n               }\n             }\n           }\n         },\n+        "website": {\n+          "type": "string"\n+        }\n       },\n       "required": [\n         "email",\n+        "website"\n       ],\n       "additionalProperties": false\n     }\n   }\n }\n')),(0,r.kt)("p",null,'which was not provided by the upstream identity provider. This can happen when\nthe user refuses to accept a certain scope (e.g. "Allow Ory Kratos access to my\nwebsite") or if the provider simply does not have this data (e.g. the upstream\nidentity provider does not collect the user\'s website).'),(0,r.kt)("p",null,"In that case the end-user ends up at the registration screen and is prompted to\nprovide the missing or invalid fields:"),(0,r.kt)(u.Z,{items:g,mdxType:"CodeTabs"}),(0,r.kt)("h2",{id:"successful-registration"},"Successful Registration"),(0,r.kt)("p",null,"Completing the registration behaves differently for Browser and API Clients. The\nRegistration Flow does not issue a Ory Kratos Login Session automatically which\nprevents Account Enumeration Attacks. If these types of attacks are not your\nconcern, you can add the session hook which will issue a session after\nsuccessful registration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/my/config/kratos.yml"',title:'"path/to/my/config/kratos.yml"'},"# $ kratos -c path/to/my/config/kratos.yml serve\nselfservice:\n  flows:\n    registration:\n      after:\n        password:\n          hooks:\n            - hook: session\n        oidc:\n          hooks:\n            - hook: session # Always enable this for oidc flows or the user experience suffers significantly!\n")),(0,r.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},'It is very important to add the "session" hook to the after ',(0,r.kt)("inlineCode",{parentName:"p"},"oidc")," registration\nhooks. Otherwise your users need to use the login flow again to be able to get a\nsession. Account Enumeration Attacks with OpenID Connect sign in flows are\ntypically not an issue if you follow the guidelines in the\n",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/guides/sign-in-with-github-google-facebook-linkedin"},"Sign in with GitHub, Google, Facebook, LinkedIn, Microsoft ... Guide"),"!"))),(0,r.kt)("h3",{id:"browser-clients"},"Browser Clients"),(0,r.kt)("p",null,"When the registration is completed successfully, Ory Kratos responds with a HTTP\n302 Redirect to the\n",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/concepts/browser-redirect-flow-completion"},"configured redirect URL"),"."),(0,r.kt)("h4",{id:"with-auto-login-on-registration"},"With Auto-Login on Registration"),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"session")," after hook is enabled, a ",(0,r.kt)("inlineCode",{parentName:"p"},"Set-Cookie")," HTTP Header is set\nalongside the HTTP 302 redirect which contains the Ory Kratos Login Session\nCookie:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"HTTP/1.1 302 Found\nCache-Control: 0\nLocation: http://127.0.0.1:4455/\nSet-Cookie: csrf_token=b8OebRPTPr5ow23mA5gIZmFNLeuMbv8pZz1jT1Ex7ys=; Path=/; Domain=127.0.0.1; Max-Age=31536000; HttpOnly\nSet-Cookie: ory_kratos_session=MTU5OTE2ODc2N3xEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJR055VlROMGRteHhSakJrUzBkbmRUUjBlVFY1V0RCRWFVTnJXVmR6V25oaHx2DICsB6IMbaHSQwnYITUZqr7Qx7CxUlnaneJWH495wQ==; Path=/; Expires=Fri, 04 Sep 2020 21:32:47 GMT; Max-Age=86400; HttpOnly; SameSite=Lax\nVary: Cookie\nDate: Thu, 03 Sep 2020 21:32:47 GMT\nContent-Length: 0\n")),(0,r.kt)("p",null,"Now, whenever the browser is making a request (with cookies) to the\n",(0,r.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1/sessions/whoami")," endpoint, the session will be returned:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'curl -s -H "Cookie: ory_kratos_session=MTU5OTE2ODc2N3xEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJR055VlROMGRteHhSakJrUzBkbmRUUjBlVFY1V0RCRWFVTnJXVmR6V25oaHx2DICsB6IMbaHSQwnYITUZqr7Qx7CxUlnaneJWH495wQ==" \\\n  http://127.0.0.1:4433/sessions/whoami | jq\n\n{\n  "id": "ede90ce6-2420-435a-a745-3d8ab1a9636c",\n  "active": true,\n  "expires_at": "2020-09-04T21:32:47.5642404Z",\n  "authenticated_at": "2020-09-03T21:32:47.5881038Z",\n  "issued_at": "2020-09-03T21:32:47.5642688Z",\n  "identity": {\n    "id": "d96e86d9-bc33-4aa5-b865-4ade8a3974b3",\n    "schema_id": "default",\n    "schema_url": "http://127.0.0.1:4433/schemas/default",\n    "traits": {\n      "email": "foouser@ory.sh",\n      "name": {\n        "first": "foo",\n        "last": "user"\n      }\n    },\n    "verifiable_addresses": [\n      {\n        "id": "81bbdeae-6333-42f2-877e-26c78acb6ea5",\n        "value": "foouser@ory.sh",\n        "verified": false,\n        "via": "email",\n        "status": "pending",\n        "verified_at": null\n      }\n    ],\n    "recovery_addresses": [\n      {\n        "id": "596c1db4-ccaa-4f4e-9623-cb7e768026ad",\n        "value": "foouser@ory.sh",\n        "via": "email"\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h3",{id:"api-clients"},"API Clients"),(0,r.kt)("p",null,"For API Clients, Ory Kratos responds with a JSON payload which includes the\nsigned up identity:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'# Inits a Registration Flow\n$ actionUrl=$(\\\n  curl -s -X GET -H "Accept: application/json" \\\n    "http://127.0.0.1:4433/self-service/registration/api" \\\n    | jq -r \'.ui.action\'\\\n)\n\n# Complete Registration Flow with password method\n$ curl -s -X POST -H  "Accept: application/json" -H "Content-Type: application/json" \\\n    -d \'{"traits.email": "registration-api@user.org", "password": "fhAzi860a", "method": "password"}\' \\\n    "$actionUrl" | jq\n\n{\n  "identity": {\n    "id": "d8baf63b-7ce6-4275-82b9-9ac6d97e5037",\n    "schema_id": "default",\n    "schema_url": "http://127.0.0.1:4433/schemas/default",\n    "traits": {\n      "email": "registration-api@user.org"\n    },\n    "verifiable_addresses": [\n      {\n        "id": "87defb49-ad69-461c-b5f6-56c1ec39dd39",\n        "value": "registration-api@user.org",\n        "verified": false,\n        "via": "email",\n        "status": "pending",\n        "verified_at": null\n      }\n    ],\n    "recovery_addresses": [\n      {\n        "id": "232793b8-8d60-427d-89e6-d0a97a7a172c",\n        "value": "registration-api@user.org",\n        "via": "email"\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h4",{id:"with-auto-login-on-registration-1"},"With Auto-Login on Registration"),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"session")," after hook is enabled, the Ory Kratos Login Session and Ory\nKratos Login Session Token are included in the response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'$ actionUrl=$(\\\n  curl -s -X GET -H "Accept: application/json" \\\n    "http://127.0.0.1:4433/self-service/registration/api" \\\n    | jq -r \'.ui.action\'\\\n)\n\n$ curl -s -X POST -H  "Accept: application/json" -H "Content-Type: application/json" \\\n    -d \'{"traits.email": "registration-api@user.org", "password": "fhAzi860a", "method": "password"}\' \\\n    "$actionUrl" | jq\n\n{\n  "session_token": "9kmrgslvw8ZCyEtSZqOmxEtnfBJIvB31",\n  "session": {\n    "id": "6d5ef6f4-ea54-4310-a762-473499835a48",\n    "active": true,\n    "expires_at": "2020-09-08T10:12:34.792802227Z",\n    "authenticated_at": "2020-09-07T10:12:34.797538934Z",\n    "issued_at": "2020-09-07T10:12:34.792813032Z",\n    "identity": {\n      "id": "8a7755df-1aac-4477-a53c-3f16fa059113",\n      "schema_id": "default",\n      "schema_url": "http://127.0.0.1:4433/schemas/default",\n      "traits": {\n        "email": "registration-session-api@user.org"\n      },\n      "verifiable_addresses": [\n        {\n          "id": "95139fe8-3360-4b08-adf6-4cc9b4555d86",\n          "value": "registration-session-api@user.org",\n          "verified": false,\n          "via": "email",\n          "status": "pending",\n          "verified_at": null\n        }\n      ],\n      "recovery_addresses": [\n        {\n          "id": "e6987729-b6fa-48d5-aa15-c0a57edfdfc4",\n          "value": "registration-session-api@user.org",\n          "via": "email"\n        }\n      ]\n    }\n  },\n  "identity": {\n    "id": "8a7755df-1aac-4477-a53c-3f16fa059113",\n    "schema_id": "default",\n    "schema_url": "http://127.0.0.1:4433/schemas/default",\n    "traits": {\n      "email": "registration-session-api@user.org"\n    },\n    "verifiable_addresses": [\n      {\n        "id": "95139fe8-3360-4b08-adf6-4cc9b4555d86",\n        "value": "registration-session-api@user.org",\n        "verified": false,\n        "via": "email",\n        "status": "pending",\n        "verified_at": null\n      }\n    ],\n    "recovery_addresses": [\n      {\n        "id": "e6987729-b6fa-48d5-aa15-c0a57edfdfc4",\n        "value": "registration-session-api@user.org",\n        "via": "email"\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h2",{id:"hooks"},"Hooks"),(0,r.kt)("p",null,"Ory Kratos allows you to configure hooks that run before and after a\nRegistration Flow. This may be helpful if you'd like to restrict registration to\nIPs coming from your internal network or other logic."),(0,r.kt)("p",null,"For more information about hooks please read the\n",(0,r.kt)("a",{parentName:"p",href:"/kratos/docs/v0.6/self-service/hooks"},"Hook Documentation"),"."))}R.isMDXComponent=!0},11748:function(e,t,n){var a={"./locale":89234,"./locale.js":89234};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=r,e.exports=i,i.id=11748},83300:function(e,t){"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},25362:function(e,t){"use strict";t.Z='$ curl -s -X GET \\\n  -H "Accept: application/json"  \\\n  http://127.0.0.1:4433/self-service/registration/api | jq\n\n{\n  "id": "406f4d53-3972-465c-b9bb-368b5f484018",\n  "type": "api",\n  "expires_at": "2021-04-28T09:26:51.492772584Z",\n  "issued_at": "2021-04-28T09:16:51.492772584Z",\n  "request_url": "http://127.0.0.1:4433/self-service/registration/api",\n  "ui": {\n    "action": "http://127.0.0.1:4433/self-service/registration?flow=406f4d53-3972-465c-b9bb-368b5f484018",\n    "method": "POST",\n    "nodes": [ /* ... */ ]\n  }\n}\n'},31295:function(e,t){"use strict";t.Z='package api\n\nimport (\n  "fmt"\n\n  "github.com/ory/kratos-client-go"\n)\n\nfunc NewKratosClient(endpoint string) *kratos.APIClient {\n  conf := kratos.NewConfiguration()\n  conf.Servers = kratos.ServerConfigurations{{URL: endpoint}}\n  return kratos.NewAPIClient(conf)\n}\n\nfunc main() {\n  c := NewKratosClient("http://127.0.0.1:4433/")\n  flow, _, err := c.PublicApi.InitializeSelfServiceRegistrationViaAPIFlow(context.Background()).Execute()\n  if err != nil {\n    // ...\n  }\n\n  fmt.Printf("%+v", rs.Payload)\n}\n'},17929:function(e,t){"use strict";t.Z="import { Configuration, PublicApi } from '@ory/kratos-client';\nconst kratos = new PublicApi(new Configuration({ basePath: 'http://127.0.0.1:4433/' }));\n\nkratos.initializeSelfServiceRegistrationViaAPIFlow()\n  .then(({ data: flow }) => {\n    console.log(flow) // see the Raw HTTP tab for the payload\n  })\n"},45400:function(e,t){"use strict";t.Z='# Simulates a browser request\n$ curl -s -v -X GET \\\n  -H "Accept: text/html"  \\\n  http://127.0.0.1:4433/self-service/registration/browser\n\n> GET /self-service/registration/browser HTTP/1.1\n> Host: 127.0.0.1:4433\n> User-Agent: curl/7.64.1\n> Accept: text/html\n>\n< HTTP/1.1 302 Found\n< Cache-Control: 0\n< Content-Type: text/html; charset=utf-8\n< Location: http://127.0.0.1:4455/auth/registration?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3\n< Set-Cookie: csrf_token=y4Ocu6V83BapwJwbPw/pnlRHHw40DZbjq5iuDrxl0Ds=; Path=/; Domain=127.0.0.1; Max-Age=31536000; HttpOnly\n<\n<a href="http://127.0.0.1:4455/auth/registration?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3">Found</a>.\n'},97469:function(e,t){"use strict";t.Z='<a href="http://127.0.0.1:4433/self-service/registration/browser">Sign up</a>\n\n\x3c!-- or --\x3e\n\n<script>\n  const initRegistration = () => {\n    window.location.href = \'http://127.0.0.1:4433/self-service/registration/browser\'\n  }\n<\/script>\n\n<a onClick="initRegistration">Sign up</a>\n'},78604:function(e,t){"use strict";t.Z="express.get('/registration', function (req, res) {\n  res.redirect(302, 'http://127.0.0.1:4433/self-service/registration/browser')\n})\n"},21310:function(e,t){"use strict";t.Z="import React from 'react'\n\nconst MyComponent = () => (\n  <a href=\"http://127.0.0.1:4433/self-service/registration/browser\">Sign up</a>\n)\n"},93844:function(e,t){"use strict";t.Z='<a href="http://127.0.0.1:4433/self-service/registration/browser">Sign up</a>\n'},18456:function(e,t){"use strict";t.Z='$ curl -H "Accept: application/json" -s \\\n  \'http://127.0.0.1:4434/self-service/registration/flows?id=388ae8da-4c44-4765-bfa8-669963d388f5\' | jq\n\n{\n  "id": "388ae8da-4c44-4765-bfa8-669963d388f5",\n  "type": "browser",\n  "expires_at": "2021-04-28T09:29:23.713785401Z",\n  "issued_at": "2021-04-28T09:19:23.713785401Z",\n  "request_url": "http://127.0.0.1:4433/self-service/registration/browser",\n  "ui": {\n    "action": "http://127.0.0.1:4433/self-service/registration?flow=388ae8da-4c44-4765-bfa8-669963d388f5",\n    "method": "POST",\n    "nodes": [\n      {\n        "type": "input",\n        "group": "default",\n        "attributes": {\n          "name": "csrf_token",\n          "type": "hidden",\n          "value": "Z9pXCAGz2oK/9Ch8x4U1ehEAKHWVngQTPFDFTlYtbK8lWzXRyDBnl3neZGUIgW44ewDjb5niFdGGM5GERhu01g==",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {}\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "traits.email",\n          "type": "email",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "E-Mail",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "password",\n          "type": "password",\n          "required": true,\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070001,\n            "text": "Password",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "traits.name.first",\n          "type": "text",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "First Name",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "traits.name.last",\n          "type": "text",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1070002,\n            "text": "Last Name",\n            "type": "info"\n          }\n        }\n      },\n      {\n        "type": "input",\n        "group": "password",\n        "attributes": {\n          "name": "method",\n          "type": "submit",\n          "value": "password",\n          "disabled": false\n        },\n        "messages": null,\n        "meta": {\n          "label": {\n            "id": 1040001,\n            "text": "Sign up",\n            "type": "info",\n            "context": {}\n          }\n        }\n      }\n    ]\n  }\n}\n'},75413:function(e,t){"use strict";t.Z='package samples\n\nimport (\n  "fmt"\n\n  "github.com/ory/kratos-client-go"\n)\n\nfunc NewKratosClient(endpoint string) *kratos.APIClient {\n  conf := kratos.NewConfiguration()\n  conf.Servers = kratos.ServerConfigurations{{URL: endpoint}}\n  return kratos.NewAPIClient(conf)\n}\n\nfunc main() {\n  ctx := context.Background()\n  flowID := "" // Usually something like: res.Request.URL.Query().Get("flow")\n\n  c := NewKratosClient("http://127.0.0.1:4433/")\n  flow, _, err := c.PublicApi.GetSelfServiceRegistrationFlow().Id(flowID).Execute()\n  if err != nil {\n    // ...\n  }\n\n  fmt.Printf("%+v", flow)\n}\n'},34339:function(e,t){"use strict";t.Z="import { Configuration, PublicApi } from '@ory/kratos-client';\nconst kratos = new PublicApi(new Configuration({ basePath: 'http://127.0.0.1:4433/' }));\n\nconst flowId = '' // usually something like: req.query.flow\n\nkratos.getSelfServiceRegistrationFlow(flowId)\n  .then(({ data: flow }) => {\n    console.log(flow) // see the Raw HTTP tab for the payload\n  })\n"},33995:function(e,t){"use strict";t.Z='$ curl -H "Accept: application/json" -s \\\n    \'http://127.0.0.1:4433/self-service/registration/flows?id=76cec270-1719-4c9e-b09a-4af8281d511e\' \\\n    | jq -r \'.ui.nodes[] | select(.attributes.name=="traits.website")\'\n\n{\n  "type": "input",\n  "group": "oidc",\n  "attributes": {\n    "name": "traits.website",\n    "type": "url",\n    "disabled": false\n  },\n  "messages": [\n    {\n      "id": 4000002,\n      "text": "Property website is missing.",\n      "type": "error",\n      "context": {\n        "property": "website"\n      }\n    }\n  ],\n  "meta": {\n    "label": {\n      "id": 1070002,\n      "text": "Website",\n      "type": "info"\n    }\n  }\n}\n'},19006:function(e,t){"use strict";t.Z='$ curl -s -H "Accept: application/json" \\\n    \'http://127.0.0.1:4433/self-service/registration/flows?id=76cec270-1719-4c9e-b09a-4af8281d511e\' \\\n    | jq -r \'.ui.messages\'\n\n[\n  {\n    "id": 4000001,\n    "text": "Authentication failed because no id_token was returned. Please accept the \\"openid\\" permission and try again.",\n    "type": "error"\n  }\n]\n'},12437:function(e,t){"use strict";t.Z='$ curl -H "Accept: application/json" -s \\\n    \'http://127.0.0.1:4433/self-service/registration/flows?id=ba7b883b-80e5-457b-9ef1-c17e6743edd0\' \\\n    | jq -r \'.ui.nodes[] | select(.attributes.name=="traits.email")\'\n\n{\n  "type": "input",\n  "group": "password",\n  "attributes": {\n    "name": "traits.email",\n    "type": "email",\n    "value": "",\n    "disabled": false\n  },\n  "messages": [\n    {\n      "id": 4000001,\n      "text": "\\"\\" is not valid \\"email\\"",\n      "type": "error"\n    },\n    {\n      "id": 4000001,\n      "text": "length must be >= 3, but got 0",\n      "type": "error"\n    }\n  ],\n  "meta": {\n    "label": {\n      "id": 1070002,\n      "text": "E-Mail",\n      "type": "info"\n    }\n  }\n}\n'},7681:function(e,t){"use strict";t.Z='$ curl -H "Accept: application/json" -s \\\n    \'http://127.0.0.1:4433/self-service/registration/flows?id=ba7b883b-80e5-457b-9ef1-c17e6743edd0\' \\\n    | jq -r \'.ui.nodes[] | select(.attributes.name=="password")\'\n\n{\n  "type": "input",\n  "group": "password",\n  "attributes": {\n    "name": "password",\n    "type": "password",\n    "required": true,\n    "disabled": false\n  },\n  "messages": [\n    {\n      "id": 4000005,\n      "text": "The password can not be used because the password has been found in data breaches and must no longer be used.",\n      "type": "error",\n      "context": {\n        "reason": "the password has been found in data breaches and must no longer be used."\n      }\n    }\n  ],\n  "meta": {\n    "label": {\n      "id": 1070001,\n      "text": "Password",\n      "type": "info"\n    }\n  }\n}\n'},89159:function(e,t,n){"use strict";t.Z=n.p+"assets/images/browser-error-c055e0574b0cb30cd617f9f1d7788cd8.png"},31980:function(e,t,n){"use strict";t.Z=n.p+"assets/images/browser-oidc-invalid-7c8f9ae2d6d492c0bcf9926dec2ffb99.png"}}]);