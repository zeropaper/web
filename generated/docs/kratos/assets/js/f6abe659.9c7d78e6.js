(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[72429],{59079:function(e,t,s){"use strict";s.d(t,{Z:function(){return h}});var n=s(67294),r=s(21140),i=s.n(r),a="graph_1lrJ",o="pointer_3d8u",l="overlay_2fuY",d="visible_2Z3U",c="backdrop_2z5L",u=s(94184),p=s.n(u);i().initialize({startOnLoad:!0,logLevel:"fatal",securityLevel:"strict",arrowMarkerAbsolute:!1,theme:"neutral",flowchart:{useMaxWidth:!0,htmlLabels:!0,rankSpacing:65,nodeSpacing:30,curve:"basis"},sequence:{useMaxWidth:!0},gantt:{useMaxWidth:!0}});var h=function(e){var t,s=e.chart,r=(0,n.useState)(!1),u=r[0],h=r[1],m=(0,n.useState)(void 0),f=m[0],g=m[1],k=(0,n.useState)("mermaid-"+Math.random().toString(36).substr(2,-1))[0],w=function(){return h(!u)};return(0,n.useEffect)((function(){i().render(k,s,(function(e){g(e)}))}),[]),n.createElement(n.Fragment,null,n.createElement("div",{onClick:w,className:p()(a,o),dangerouslySetInnerHTML:{__html:f}}),n.createElement("div",{onClick:w,className:p()(l,o,a,(t={},t[d]=u,t))},n.createElement("div",{onClick:function(e){return e.stopPropagation()},className:p()(c,a),dangerouslySetInnerHTML:{__html:f}})))}},78157:function(e,t,s){"use strict";s.r(t),s.d(t,{frontMatter:function(){return l},contentTitle:function(){return d},metadata:function(){return c},toc:function(){return u},default:function(){return h}});var n=s(87462),r=s(63366),i=(s(67294),s(3905)),a=s(59079),o=["components"],l={id:"user-settings",title:"User Settings",sidebar_label:"Overview"},d=void 0,c={unversionedId:"self-service/flows/user-settings",id:"version-v0.4/self-service/flows/user-settings",isDocsHomePage:!1,title:"User Settings",description:"ORY Kratos allows users to update their own settings and profile information",source:"@site/versioned_docs/version-v0.4/self-service/flows/user-settings.mdx",sourceDirName:"self-service/flows",slug:"/self-service/flows/user-settings",permalink:"/kratos/docs/v0.4/self-service/flows/user-settings",editUrl:"https://github.com/ory/kratos/edit/master/docs/versioned_docs/version-v0.4/self-service/flows/user-settings.mdx",tags:[],version:"v0.4",lastUpdatedBy:"aeneasr",lastUpdatedAt:1594198226,formattedLastUpdatedAt:"7/8/2020",frontMatter:{id:"user-settings",title:"User Settings",sidebar_label:"Overview"},sidebar:"version-v0.4/docs",previous:{title:"Social Sign In with OpenID Connect and OAuth2",permalink:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/openid-connect-social-sign-in-oauth2"},next:{title:"User Profile Management",permalink:"/kratos/docs/v0.4/self-service/flows/user-settings/user-profile-management"}},u=[{value:"Self-Service User Settings for Browser Applications",id:"self-service-user-settings-for-browser-applications",children:[{value:"The Settings User Interface",id:"the-settings-user-interface",children:[],level:3},{value:"Code",id:"code",children:[{value:"Server-side route",id:"server-side-route",children:[],level:4},{value:"Views",id:"views",children:[],level:4}],level:3},{value:"Server-Side Browser Applications",id:"server-side-browser-applications",children:[{value:"Network Architecture",id:"network-architecture",children:[],level:4},{value:"User Settings Process Sequence",id:"user-settings-process-sequence",children:[],level:4}],level:3},{value:"Client-Side Browser Applications",id:"client-side-browser-applications",children:[{value:"User Settings Request State",id:"user-settings-request-state",children:[],level:4}],level:3}],level:2},{value:"Self-Service User Settings for API Clients",id:"self-service-user-settings-for-api-clients",children:[],level:2},{value:"Hooks",id:"hooks",children:[],level:2}],p={toc:u};function h(e){var t=e.components,s=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"ORY Kratos allows users to update their own settings and profile information\nusing two principal flows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Browser-based (easy): This flow works for all applications running on top of a\nbrowser. Websites, single-page apps, Cordova/Ionic, and so on."),(0,i.kt)("li",{parentName:"ul"},"API-based (advanced): This flow works for native applications like iOS\n(Swift), Android (Java), Microsoft (.NET), React Native, Electron, and others.")),(0,i.kt)("p",null,"The flow described here is implemented by the\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-settings/user-profile-management"},"profile"),",\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/username-email-password"},"password"),", and\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/openid-connect-social-sign-in-oauth2"},"oidc"),"\nstrategy."),(0,i.kt)("h2",{id:"self-service-user-settings-for-browser-applications"},"Self-Service User Settings for Browser Applications"),(0,i.kt)("p",null,"ORY Kratos supports browser applications that run on server-side (e.g. Java,\nNodeJS, PHP) as well as client-side (e.g. JQuery, ReactJS, AngularJS, ...)."),(0,i.kt)("p",null,"Browser-based user settings management makes use of three core HTTP\ntechnologies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"HTTP Redirects"),(0,i.kt)("li",{parentName:"ul"},"HTTP POST (",(0,i.kt)("inlineCode",{parentName:"li"},"application/json"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"application/x-www-urlencoded"),") and RESTful GET\nrequests."),(0,i.kt)("li",{parentName:"ul"},"HTTP Cookies to prevent CSRF and Session Hijaking attack vectors.")),(0,i.kt)("p",null,"The browser flow is the easiest and most secure to set up and integrated with.\nORY Kratos takes care of all required session and CSRF cookies and ensures that\nall security requirements are fulfilled."),(0,i.kt)("p",null,"This flow is not suitable for scenarios where you use purely programmatic\nclients that do not work well with HTTP Cookies and HTTP Redirects."),(0,i.kt)("h3",{id:"the-settings-user-interface"},"The Settings User Interface"),(0,i.kt)("p",null,"The Settings User Interface is a route (page / site) in your application that\nrenders the user settings / profile management User Interface / HTML Form:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Profile management --\x3e\n<form action="..." method="POST">\n  <input type="hidden" name="csrf_token" value="cdef..." />\n  <input type="string" name="first_name" />\n  <input type="string" name="last_name" />\n  <input type="string" name="address" />\n  <input type="..." name="..." />\n  <input type="submit" />\n</form>\n\n\x3c!-- Password management --\x3e\n<form action="..." method="POST">\n  <input type="hidden" name="csrf_token" value="cdef..." />\n  <input\n    type="password"\n    name="password"\n    placeholder="Enter your new password here"\n  />\n</form>\n\n\x3c!-- Social Sign in  management --\x3e\n<form action="..." method="POST">\n  <input type="hidden" name="csrf_token" value="cdef..." />\n  \x3c!-- ... --\x3e\n</form>\n')),(0,i.kt)("p",null,"Reference these UI endpoints your ORY Kratos config file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="path/to/kratos/config.yml"',title:'"path/to/kratos/config.yml"'},"selfservice:\n  flows:\n    settings:\n      ui_url: https://.../settings\n")),(0,i.kt)("p",null,"In stark contrast to other Identity Systems, ORY Kratos does not render this\nHTML. Instead, you need to implement the HTML code in your application (e.g.\nNodeJS + ExpressJS, Java, PHP, ReactJS, ...), which gives you extreme\nflexibility and customizability in your user interface flows and designs."),(0,i.kt)("p",null,"Each Settings Strategy (",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-settings/user-profile-management"},"Profile"),",\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/username-email-password"},"Username and Password"),",\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/openid-connect-social-sign-in-oauth2"},"Social Sign In"),",\nPasswordless, ...) works a bit different but they all boil down to the same\nabstract sequence:"),(0,i.kt)(a.Z,{chart:"\nsequenceDiagram\n  participant B as Browser\n  participant K as ORY Kratos\n  participant A as Your Application\n  B->>K: Initialize Settings Flow\n  K->>B: Redirects to your Application's /settings_ui endpoint\n  B->>A: Calls /settings_ui\n  A--\x3e>K: Fetches data to render forms etc\n  B--\x3e>A: Fills out forms, clicks e.g. \"Save Changes\"\n  B->>K: POSTs data to\n  K--\x3e>K: Processes Settings Info\n  alt Settings data valid\n    K--\x3e>B: Updates Identity Settings\n    K->>B: Redirects to e.g. Dashboard\n  else Setings data invalid\n    K--\x3e>B: Redirects to your Applicaiton's /settings_ui endpoint\n    B->>A: Calls /settings_ui\n    A--\x3e>K: Fetches data to render form fields and errors\n    B--\x3e>A: Fills out forms again, corrects errors\n    B->>K: POSTs data again - and so on...\n  end\n",mdxType:"Mermaid"}),(0,i.kt)("h3",{id:"code"},"Code"),(0,i.kt)("p",null,"The code example used here is universal and does not use an SDK because we want\nyou to understand the fundamentals of how this flow works."),(0,i.kt)("p",null,"While this example assumes a Server-Side Application, a Client-Side (e.g.\nReactJS) Application would work the same, but use ORY Kratos' Public API\ninstead."),(0,i.kt)("h4",{id:"server-side-route"},"Server-side route"),(0,i.kt)("p",null,"You will notice that this endpoint is very similar to the one documented for\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration"},"User Login and Registration"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// Uses the ORY Kratos NodeJS SDK - for more SDKs check:\n//\n//  https://www.ory.sh/kratos/docs/sdk/index\nconst { CommonApi } = require('@oryd/kratos-client')\n\n// The browser config key is used to redirect the user. It reflects where ORY Kratos' Public API\n// is accessible from. Here, we're assuming traffic going to `http://example.org/.ory/kratos/public/`\n// will be forwarded to ORY Kratos' Public API.\nconst kratosBrowserUrl = 'http://example.org/.ory/kratos/public/'\n\n// Initializes the SDK with ORY Kratos' Admin API.\nconst commonApi = new CommonApi('https://ory-kratos-admin.example-org.vpc/')\n\n// This route would be used like:\n//\n//    app.get('/user/settings', settingsHandler)\n//\nexport const settingsHandler = (req, res, next) => {\n  // The request ID is used to identify User Settings Request and\n  // return data like the csrf_token and so on.\n  const request = req.query.request\n  if (!request) {\n    console.log('No request found in URL, initializing flow.')\n    res.redirect(`${kratosBrowserUrl}/self-service/browser/flows/settings`)\n    return\n  }\n\n  commonApi\n    .getSelfServiceBrowserSettingsRequest(request)\n    .then(({ body, response }) => {\n      if (response.statusCode !== 200) {\n        res.redirect(`${kratosBrowserUrl}/self-service/browser/flows/settings`)\n        return\n      }\n\n      // \"body\" contains all the request data for this User Settings Request.\n      // You can process that data here, if you want.\n\n      // Lastly, you probably want to render the data using a view (e.g. Jade Template):\n      res.render('settings', body)\n    })\n  // Handle errors using ExpressJS' next functionality:\n  //\n  //    .catch(next)\n}\n")),(0,i.kt)("h4",{id:"views"},"Views"),(0,i.kt)("p",null,"Implementing the view is simple as ORY Kratos provides you with all the\ninformation you need for rendering the forms. The following example illustrates\na generic form generator (we use handlebars here) that works with ORY Kratos:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-handlebars",metastring:'name="views/partials/form.hbs"',name:'"views/partials/form.hbs"'},'<form action="{{form.action}}" method="{{form.method}}">\n    {{~#each form.errors~}}\n        \x3c!-- global form validation errors --\x3e\n        <div class="error">{{message}}</div>\n    {{~/each~}}\n\n    {{#each form.fields}}\n        {{~#each errors~}}\n            \x3c!-- validation errors for this specific field --\x3e\n            <div class="error">{{message}}</div>\n        {{~/each~}}\n        <input name="{{name}}" type="{{type}}" value="{{value}}" {{#if disabled}}disabled{{/if}}>\n    {{/each}}\n\n    <button type="submit">Save</button>\n</form>\n')),(0,i.kt)("p",null,'In your main "Settings" view you would then consume this template for all the\nmethods you want to support:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-handlebars",metastring:'name="views/settings.hbs"',name:'"views/settings.hbs"'},"\x3c!-- Make profile changes form: --\x3e\n{{#if methods.profile.config}}\n    {{> form form=methods.profile.config}}\n{{/if}}\n\n\x3c!-- Change passowrd form: --\x3e\n{{#if methods.password.config}}\n    {{> form form=methods.password.config}}\n{{/if}}\n\n\x3c!-- ... form: --\x3e\n\x3c!-- ... --\x3e\n")),(0,i.kt)("p",null,"For details on payloads and potential HTML snippets consult the individual\nSelf-Service Strategies for:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/username-email-password"},"Username and Password Strategy")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/kratos/docs/v0.4/self-service/flows/user-login-user-registration/openid-connect-social-sign-in-oauth2"},"Social Sign In Strategy")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/kratos/docs/v0.4/self-service/flows/user-settings/user-profile-management"},"Profile"))),(0,i.kt)("h3",{id:"server-side-browser-applications"},"Server-Side Browser Applications"),(0,i.kt)("p",null,"Let's take a look at the concrete network topologies, calls, and payloads. Here,\nwe're assuming that you're running a server-side browser application (written in\ne.g. PHP, Java, NodeJS) to render the settings screen on the server and make all\nAPI calls from that server code. The counterpart to this would be a client-side\nbrowser application (written in e.g. Vanilla JavaScript, JQuery, ReactJS,\nAngularJS, ...) that uses AJAX requests to fetch data. For these type of\napplications, read this section first and go to section\n",(0,i.kt)("a",{parentName:"p",href:"#client-side-browser-applications"},"Client-Side Browser Applications")," next."),(0,i.kt)("h4",{id:"network-architecture"},"Network Architecture"),(0,i.kt)("p",null,"We recommend checking out the\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/v0.4/quickstart#network-architecture"},"Quickstart Network Architecture")," for\na high-level, exemplary, overview of the network. In summary:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The SecureApp (your application) is exposed at ",(0,i.kt)("a",{parentName:"li",href:"http://127.0.0.1:4455"},"http://127.0.0.1:4455")," and\nproxies requests matching path ",(0,i.kt)("inlineCode",{parentName:"li"},"./ory/kratos/public/*")," to ORY Krato's Public\nAPI Port."),(0,i.kt)("li",{parentName:"ol"},"ORY Kratos exposes (for debugging only!!) the Public API at\n",(0,i.kt)("a",{parentName:"li",href:"http://127.0.0.1:4433"},"http://127.0.0.1:4433")," and Admin API at ",(0,i.kt)("a",{parentName:"li",href:"http://127.0.0.1:4434"},"http://127.0.0.1:4434"),"."),(0,i.kt)("li",{parentName:"ol"},'Within the "intranet" or "private network", ORY Kratos is exposed at\nhttp://kratos:4433 and http://kratos:4434. These URLs are be used by the\nSecureApp to communicate with ORY Kratos.')),(0,i.kt)("p",null,"Keep in mind that his architecture is just one of many possible network\narchitectures. It is however one of the simplest as well and it works locally.\nFor production deployments you would probably use an Reverse Proxy such as\nNginx, Kong, Envoy, ORY Oathkeeper, or others."),(0,i.kt)("h4",{id:"user-settings-process-sequence"},"User Settings Process Sequence"),(0,i.kt)("p",null,"The User Settings Flow is composed of several high-level steps summarized in\nthis state diagram:"),(0,i.kt)(a.Z,{chart:'\nstateDiagram\n  s1: User browses app\n  s3: User ends up at settings_ui which renders the User Settings Form\n  s4: Execute "After Settings Hook(s)"\n  s5: Update "Settings Request" with Error Context(s)\n  s6: Settings update successful\n\t[*] --\x3e s1\n  s1 --\x3e s3 : User clicks "Manage Account" and is redirected to Settings Init Endpoint\n  s3 --\x3e s4 : User provides valid profile data\n  s3 --\x3e s5 : User provides invalid profile data\n  s5 --\x3e s3 : User is redirected to Settings UI URL\n  s4 --\x3e Error : A Hook fails\n  s4 --\x3e s6\n  s6 --\x3e [*]\n  Error --\x3e [*]\n',mdxType:"Mermaid"}),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The flow is initiated by directing the user's browser to\n",(0,i.kt)("inlineCode",{parentName:"li"},"http://127.0.0.1:4455/.ory/kratos/public/self-service/browser/flows/settings"),"."),(0,i.kt)("li",{parentName:"ol"},"ORY Kratos does some internal processing (e.g. checks if a session cookie is\nset, generates payloads for form fields, sets CSRF token, ...) and redirects\nthe user's browser to the Settings UI URL which is defined using the\n",(0,i.kt)("inlineCode",{parentName:"li"},"selfservice.flows.settings.ui_url")," config or\n",(0,i.kt)("inlineCode",{parentName:"li"},"SELFSERVICE_FLOWS_SETTINGS_UI_URL")," environment variable, which is set to the\nui endpoints - for example ",(0,i.kt)("inlineCode",{parentName:"li"},"https://127.0.0.1:4455/settings"),". The user's\nbrowser is thus redirected to\n",(0,i.kt)("inlineCode",{parentName:"li"},"https://127.0.0.1:4455/settings?request=abcde"),". The ",(0,i.kt)("inlineCode",{parentName:"li"},"request")," query\nparameter includes a unique ID which will be used to fetch contextual data\nfor this settings request."),(0,i.kt)("li",{parentName:"ol"},"Your Server-Side Application makes a ",(0,i.kt)("inlineCode",{parentName:"li"},"GET")," request to\n",(0,i.kt)("inlineCode",{parentName:"li"},"http://kratos:4434/self-service/browser/flows/requests/settings?request=abcde"),".\nORY Kratos responds with a JSON Payload that contains data (form fields,\nerror messages, ...) for all enabled User Profile Strategies:",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json5"},"{\n  id: 'abcde',\n  request_url: '...',\n  methods: {\n    profile: { method: 'profile', config: { action: '...', fields: [] } },\n    password: { method: 'password', config: { action: '...', fields: [] } },\n    oidc: { method: 'oidc', config: { action: '...', fields: [] } }\n  }\n}\n"))),(0,i.kt)("li",{parentName:"ol"},"Your Server-Side applications renders the data however you see fit. The User\ninteracts with it and completes the flow by e.g. updating the password or\nsome other profile data."),(0,i.kt)("li",{parentName:"ol"},"The User's browser makes a request to one of ORY Kratos' Strategy URLs (e.g.\n",(0,i.kt)("inlineCode",{parentName:"li"},"http://127.0.0.1:4455/.ory/kratos/public/self-service/browser/flows/settings/strategies/profile?request=abcde"),"\nor ",(0,i.kt)("inlineCode",{parentName:"li"},"/self-service/browser/flows/settings/strategies/password?request=abcde"),").\nORY Kratos validates the data:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If the form data is invalid, the Settings Request's JSON Payload is\nupdated - for example with",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json5"},"{\n  id: 'abcde',\n  methods: {\n    oidc: {\n      method: 'oidc',\n      config: {\n        /* ... */\n      }\n    },\n    password: {\n      method: 'password',\n      config: {\n        /* ... */\n        messages: [\n          {\n            id: 4000006,\n            text: 'The provided credentials are invalid. Check for spelling mistakes in your password or username, email address, or phone number.',\n            type: 'error'\n          }\n        ]\n      }\n    }\n  }\n}\n")),"and the user's Browser is redirected back to the Settings UI:\n",(0,i.kt)("inlineCode",{parentName:"li"},"https://127.0.0.1:4455/settings_ui?request=abcde"),"."),(0,i.kt)("li",{parentName:"ul"},"If the data is valid but the modifications require proof of identity (e.g.\nbecause the primary email address or the password was changed), a settings\nflow is executed. Only after a successful settings flow will the changed\ndata be stored!"),(0,i.kt)("li",{parentName:"ul"},"If data is valid, ORY Kratos proceeds with the next step."))),(0,i.kt)("li",{parentName:"ol"},"ORY Kratos executes hooks defined in the ",(0,i.kt)("strong",{parentName:"li"},"After Settings Hooks"),". If a\nfailure occurs, the whole flow is aborted."),(0,i.kt)("li",{parentName:"ol"},"The client receives the expected response. For browsers, this is a HTTP\nRedirection, for API clients it will be a JSON response containing the\nsession and/or identity. For more information on this topic check\n",(0,i.kt)("a",{parentName:"li",href:"/kratos/docs/v0.4/concepts/browser-redirect-flow-completion"},"Self-Service Flow Completion"),".")),(0,i.kt)(a.Z,{chart:'\nsequenceDiagram\n  participant B as Browser\n  participant A as Your Server-Side Application\n  participant KP as ORY Kratos Public API\n  participant KA as ORY Kratos Admin API\n  B->>+A: GET /.ory/kratos/public/self-service/browser/flows/settings\n  A->>+KP: GET /self-service/browser/flows/settings\n  KP--\x3e>-A: HTTP 302 Found /settings?request=abcde\n  A--\x3e>-B: HTTP 302 Found /settings?request=abcde\n  B->>+A: GET /settings?request=abcde\n  A->>+KA: GET /self-service/browser/flows/requests/settings?request=abcde\n  KA->>-A: Sends Settings Request JSON Payload\n  Note over A,KA:  {"methods":{"password":...,"oidc":..}}\n  A--\x3e>A: Generate and render HTML\n  A--\x3e>-B: Return HTML (Form, ...)\n  B--\x3e>B: Fill out HTML\n  B->>+KP: POST HTML Form\n  KP--\x3e>KP: Checks profile data\n  alt Setting updates are valid\n    KP--\x3e>-KP: Execute Jobs defined in "After Settings Workflow(s)"\n    KP--\x3e>A: HTTP 302 Found /dashboard\n  else Setting updates require re-authentication\n    Note over KP,B: User is asked to login in again. If the login is valid, the data is updated.\n    KP--\x3e>B: HTTP 302 Found /settings?request=abcde\n  else Setting updates are invalid\n    Note over KP,B: User retries settings flow\n    KP--\x3e>B: HTTP 302 Found /settings?request=abcde\n  end\n',mdxType:"Mermaid"}),(0,i.kt)("h3",{id:"client-side-browser-applications"},"Client-Side Browser Applications"),(0,i.kt)("p",null,"Because Client-Side Browser Applications do not have access to ORY Kratos' Admin\nAPI, they must use the ORY Kratos Public API instead. The flow for a Client-Side\nBrowser Application is almost the exact same as the one for Server-Side\nApplications, with the small difference that\n",(0,i.kt)("inlineCode",{parentName:"p"},"https://127.0.0.1:4455/.ory/kratos/public/self-service/browser/flows/requests/settings?request=abcde"),"\nwould be called via AJAX instead of making a request to\n",(0,i.kt)("inlineCode",{parentName:"p"},"https://kratos:4434/self-service/browser/flows/requests/settings?request=abcde"),"."),(0,i.kt)("p",null,"To prevent brute force, guessing, session injection, and other attacks, it is\nrequired that cookies are working for this endpoint. The cookie set in the\ninitial HTTP request made to\n",(0,i.kt)("inlineCode",{parentName:"p"},"https://127.0.0.1:4455/.ory/kratos/public/self-service/browser/settings")," MUST\nbe set and available when calling this endpoint!"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The initialization request\n(",(0,i.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:4455/.ory/kratos/public/self-service/browser/flows/settings"),")\n",(0,i.kt)("strong",{parentName:"p"},"cannot")," be made via AJAX or API requests. You ",(0,i.kt)("strong",{parentName:"p"},"must")," open that URL in the\nuser's browser using e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"window.open")," ",(0,i.kt)("inlineCode",{parentName:"p"},"location.href")," or plain and simple old\n",(0,i.kt)("inlineCode",{parentName:"p"},"<a href=...>"),"."))),(0,i.kt)("h4",{id:"user-settings-request-state"},"User Settings Request State"),(0,i.kt)("p",null,"The Settings Request contains a state with two possible values:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"show_form"),": No user data has been collected, or it is invalid, and thus the\nform should be shown."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"successful"),": Indicates that the settings request has been updated\nsuccessfully with the provided data. The state will stay ",(0,i.kt)("inlineCode",{parentName:"li"},"successful")," when\nrepeatedly checking. If the form is still displayed and the user adds more\ndata, the state will revert back to ",(0,i.kt)("inlineCode",{parentName:"li"},"show_form")," on validation errors.")),(0,i.kt)(a.Z,{chart:"stateDiagram-v2\n[*] --\x3e show_form\nshow_form --\x3e show_form: Validation fails\nshow_form --\x3e success: Identity was updated\nsuccess --\x3e show_form: Validation fails\nsuccess --\x3e [*]\n",mdxType:"Mermaid"}),(0,i.kt)("h2",{id:"self-service-user-settings-for-api-clients"},"Self-Service User Settings for API Clients"),(0,i.kt)("p",null,"Will be addressed in a future release."),(0,i.kt)("h2",{id:"hooks"},"Hooks"),(0,i.kt)("p",null,"ORY Kratos allows you to configure hooks that run before and after a profile\nupdate was successful. For more information about hooks please read the\n",(0,i.kt)("a",{parentName:"p",href:"../hooks/index"},"Hook Documentation"),"."))}h.isMDXComponent=!0},11748:function(e,t,s){var n={"./locale":89234,"./locale.js":89234};function r(e){var t=i(e);return s(t)}function i(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=11748}}]);