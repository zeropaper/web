<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.ory.sh"]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//sqa-web.ory.sh/";_paq.push(["setTrackerUrl",e+"np.php"]),_paq.push(["setSiteId","2"]);var a=document,p=a.createElement("script"),t=a.getElementsByTagName("script")[0];p.type="text/javascript",p.async=!0,p.src=e+"js/np.min.js",t.parentNode.insertBefore(p,t)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Oathkeeper" href="/oathkeeper/docs/opensearch.xml"><title data-react-helmet="true">Error Handlers | ORY Oathkeeper</title><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//oathkeeper/docs/pipeline/error"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v0.38"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v0.38"><meta data-react-helmet="true" property="og:title" content="Error Handlers | ORY Oathkeeper"><meta data-react-helmet="true" name="description" content="A error handler is responsible for executing logic after, for example,"><meta data-react-helmet="true" property="og:description" content="A error handler is responsible for executing logic after, for example,"><link data-react-helmet="true" rel="shortcut icon" href="/oathkeeper/docs/img/favico.png"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//oathkeeper/docs/pipeline/error"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//oathkeeper/docs/pipeline/error" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.ory.sh//oathkeeper/docs/pipeline/error" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/oathkeeper/docs/assets/css/styles.828e83e3.css">
<link rel="preload" href="/oathkeeper/docs/assets/js/runtime~main.55f946a5.js" as="script">
<link rel="preload" href="/oathkeeper/docs/assets/js/main.55275cf4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div id="route-identifier" data-route="/oathkeeper/docs/pipeline/error"><div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">Sign up for <a href="https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53&group[17097][16]=1">important security announcements</a> and if you like ORY Oathkeeper give it a ‚≠êÔ∏è on <a target="_blank" rel="noopener noreferrer" href="https://github.com/ory/oathkeeper">GitHub</a>!</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">√ó</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/oathkeeper/docs/img/logo-oathkeeper.svg" alt="ORY Oathkeeper" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/oathkeeper/docs/img/logo-oathkeeper.svg" alt="ORY Oathkeeper" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Home</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ory/oathkeeper/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/oathkeeper/docs/">v0.38</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/oathkeeper/docs/next/pipeline/error">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/oathkeeper/docs/pipeline/error">v0.38</a></li><li><a class="dropdown__link" href="/oathkeeper/docs/v0.37/pipeline/error">v0.37</a></li><li><a class="dropdown__link" href="/oathkeeper/docs/versions">All versions</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Documentation</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Open Source Documentation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Ory Kratos</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Ory Keto</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Ory Hydra</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Ory Oathkeeper</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Core Concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/api-access-rules">API Access Rules</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Handlers</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/pipeline">Access Rule Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/pipeline/authn">Authenticators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/pipeline/authz">Authorizers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/oathkeeper/docs/pipeline/mutator">Mutators</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/oathkeeper/docs/pipeline/error">Error Handlers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Reference</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">SDKs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Development</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: v0.38</span><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Error Handlers</h1></header><p>A error handler is responsible for executing logic after, for example,
authentication or authorization failed. ORY Oathkeeper supports different error
handlers and we will add more as the project progresses.</p><p>A error handler can be configured to match on certain conditions, for example,
it is possible to configure the <code>json</code> error handler to only be executed if the
HTTP Header <code>Accept</code> contains <code>application/json</code>.</p><p>Each error handler has two keys:</p><ul><li><code>handler</code> (string, required): Defines the handler (e.g. <code>noop</code>) to be used.</li><li><code>config</code> (object, optional): Configures the handler. Configuration keys vary
per handler. The configuration can be defined in the global configuration
file, or per access rule.</li></ul><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;handler&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;config&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can define more than one error handler in the Access Rule. Depending on
their matching conditions (see next chapter), the appropriate error handler will
be chosen.</p><p>Please be aware that defining error handlers with overlapping matching
conditions will cause errors, because ORY Oathkeeper will not know which error
handler to execute!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="error-matching"></a>Error Matching<a class="hash-link" href="#error-matching" title="Direct link to heading">#</a></h2><p>You can configure the error handlers in such a way, that - for example - ORY
Oathkeeper responds, in the case of an error, with</p><ul><li>a JSON response, such as
<code>{&quot;error&quot;:{&quot;code&quot;:403,&quot;status&quot;:&quot;Forbidden&quot;,&quot;message&quot;:&quot;Access credentials are not sufficient to access this resource&quot;}}</code>,
when the client that expects JSON (<code>Accept: application/json</code>);</li><li>an XML response when the API Client expects XML (<code>Accept: application/xml</code>);</li><li>a HTTP Redirect (HTTP Status Found - 302) to <code>/login</code> when the endpoint is
directly (no AJAX) accessed from a browser
(<code>Accept: text/html,application/xhtml+xml</code>).</li></ul><p>There are also other possible matching strategies - such as defining a response
per error type (unauthorized, forbidden, internal_server_error, ...) , per HTTP
<code>Content-Type</code> Header (similar to <code>Accept</code>), or based on the Remote IP Address.</p><p>All match definitions are set in the handler&#x27;s config, using the <code>when</code> key.
This is the same for all handlers!</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json5"><pre tabindex="0" class="prism-code language-json5 codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  handler: &#x27;json&#x27;, // or redirect, www_authenticate, ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    when: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        error: [&#x27;unauthorized&#x27;, &#x27;...&#x27;, &#x27;...&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If <code>when</code> is empty, then no conditions are applied and the error handler is
always matching! In fact, this is also true for all subkeys. If left empty, the
matching condition will not be applied and is thus always true!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fallback"></a>Fallback<a class="hash-link" href="#fallback" title="Direct link to heading">#</a></h3><p>Error handling can be set globally and per access rule. ORY Oathkeeper will
first check for any access rule specific error handling before falling back to
the globally defined error handling.</p><p>Similar to other pipeline handlers (authentication, authorization, mutation),
you must enable the error handlers in the global ORY Oathkeeper config, except
for the <code>json</code> error handler which is always enabled by default:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># this is true by default</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># config:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#   when: ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">redirect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># this is false by default</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># config:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#   when: ...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As discussed in the previous section, when <code>config.when</code> is empty, the error
handler will always match. This of course is a problem because ORY Oathkeeper
now does not know if it should redirect or send a JSON error!</p><p>Therefore, an additional configuration - called <code>fallback</code> - is available:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># `[&quot;json&quot;]` is the default!</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># this is true by default</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># config:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#   when: ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">redirect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># this is false by default</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//mywebsite/login</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># when: ...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This feature tells ORY Oathkeeper that the <code>json</code> error handler should be used
as fallback. You could also define multiple fallback handlers - the first
matching handler will be the one and only executed! This makes sense if you
additionally configure the <code>when</code> section:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> redirect</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> json</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">redirect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">accept</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> text/*</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this configuration example, ORY Oathkeeper would first check if the HTTP
Request Header contains <code>Accept: text/html</code> (or <code>text/xhtml</code>, <code>text/text</code>, ...)
and if not, would return a JSON Error Message.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="matchers"></a>Matchers<a class="hash-link" href="#matchers" title="Direct link to heading">#</a></h3><p>All matchers are defined under the <code>config.when</code> key of the error handler, both
in the global config and in the access rule:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json5"><pre tabindex="0" class="prism-code language-json5 codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// access-rule.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  handler: &#x27;json&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    when: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        error: [&#x27;unauthorized&#x27;, &#x27;...&#x27;, &#x27;...&#x27;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">redirect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> unauthorized</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can define multiple when clauses which allows you to differentiate between
error types and HTTP Requests. The when sections are combined with <code>OR</code> while
the subkeys (<code>error</code>, <code>request.header.accept</code>, <code>request.header.content_type</code>,
...) are matched with <code>AND</code>. Keys that have arrays as values (<code>error</code>,
<code>request.header.accept</code>, <code>request.header.content_type</code>, ...) are usually matched
with <code>OR</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .oathkeeper.yaml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">redirect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> unauthorized</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> internal_server_error</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># AND</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">remote_ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.1.0/24</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.178.1.0/24</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> forbidden</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> not_found</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># AND</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">accept</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> text/html</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> text/xhtml</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># AND</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">content_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> application/x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">www</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">form</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">urlencoded</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> multipart/form</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="error"></a>Error<a class="hash-link" href="#error" title="Direct link to heading">#</a></h4><p>The <code>config.when.#.error</code> key may contain zero, one, or multiple error names
that must match for this matching condition to be true. The error names are
derived (lowercase and whitespaces replaced with <code>_</code>) from the well-defined
<a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="noopener noreferrer">HTTP Status</a> messages
such as <code>Not Found</code>, <code>Forbidden</code>, <code>Internal Server Error</code>, and so on.</p><p>Here are some examples:</p><ul><li><code>Internal Server Error</code> (500) -&gt; <code>{&quot;errors&quot;: [&quot;internal_server_error&quot;]}</code></li><li><code>Forbidden</code> (403) -&gt; <code>{&quot;errors&quot;: [&quot;forbidden&quot;]}</code></li><li><code>Not Found</code> (404) -&gt; <code>{&quot;errors&quot;: [&quot;not_found&quot;]}</code></li><li><code>Bad Request</code> (400) -&gt; <code>{&quot;errors&quot;: [&quot;bad_request&quot;]}</code></li></ul><p>Keep in mind that these errors must be emitted by ORY Oathkeeper itself, not by
the upstream API. Therefore, most HTTP Status Codes will not have any effect
because ORY Oathkeeper - as of now - mostly returns 401, 403, 500 error codes.</p><p>As discussed previously, if this configuration key is left empty, then all error
types will match!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="http-request-remote-ip"></a>HTTP Request: Remote IP<a class="hash-link" href="#http-request-remote-ip" title="Direct link to heading">#</a></h4><p>The HTTP Remote IP is the IP of the Client that initially made the request. The
Remote Address is matched using
<a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CIDR Notation</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">remote_ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.1.0/24</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This configuration would match a HTTP Request coming directly from
<code>192.168.1.1</code>, <code>192.168.1.2</code>, and so on.</p><p>If ORY Oathkeeper runs behind a Load Balancer or any other type of Reverse
Proxy, you can configure ORY Oathkeeper to check the
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" target="_blank" rel="noopener noreferrer"><code>X-Forwarded-For</code> HTTP Header</a>
header as well:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">remote_ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">respect_forwarded_for_header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># defaults to false</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.1.0/24</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As discussed previously, if this configuration key is left empty, then all
remote IPs will match!</p><p>HTTP Requests that include one of the matching IP Addresses in the
<code>X-Forwarded-For</code> HTTP Header, for example
<code>X-Forwarded-For: 123.123.123.123, ..., 192.168.1.1, ...</code>, now match this error
handler.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="http-request-header-accept"></a>HTTP Request Header: Accept<a class="hash-link" href="#http-request-header-accept" title="Direct link to heading">#</a></h4><p>The HTTP <code>Accept</code> Header is the most common way to tell an HTTP API what MIME
content type is expected. For example, FireFox sends
<code>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code> for
all regular requests (e.g. when opening <a href="https://www.ory.sh/" target="_blank" rel="noopener noreferrer">www.ory.sh</a>). And
a REST API Client usually sends <code>Accept: application/json</code>.</p><p>Therefore, using the <code>Accept</code> header is one of the most common ways to
distinguish between &quot;regular&quot; browser traffic, REST API traffic, and other types
of HTTP traffic.</p><p>In ORY Oathkeeper, you can specify the matching conditions for the Accept header
as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">accept</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> text/html</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> text/*</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The defined matching condition would apply if a client sends one of the
following <code>Accept</code> headers:</p><ul><li><code>Accept: text/html</code></li><li><code>Accept: text/xhtml</code></li><li><code>Accept: text/xhtml+xml</code></li><li><code>Accept: text/...</code></li><li><code>Accept: text/*</code></li></ul><p>Most browsers (see the FireFox example) also send wildcard <code>Accept</code> headers such
as <code>*/*</code>. To prevent multiple conditions to match, HTTP Accept Headers from the
client are interpreted literally, meaning that wildcards are not interpreted.</p><p>Assuming the client sends <code>Accept: */*</code> and the error condition is set to
<code>accept: [&quot;text/text&quot;]</code>, the error condition would not match. If however the
client sends <code>Accept: text/text</code> and the error condition is set to
<code>accept: [&quot;*/*&quot;]</code>, then the condition would match.</p><p>To match against wildcards in the <code>Accept</code> header, you have to explicitly define
them in the error condition. Setting the configuration to <code>accept: [&quot;*/*&quot;]</code> will
match <code>Accept: */*</code> and of course any other type such as <code>Accept: text/*</code>
<code>Accept: text/html</code>, and so on.</p><p>As discussed previously, if this configuration key is left empty, then all
<code>Accept</code> headers will match!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="http-request-header-content-type"></a>HTTP Request Header: Content-Type<a class="hash-link" href="#http-request-header-content-type" title="Direct link to heading">#</a></h4><p>The
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener noreferrer">HTTP Content Type</a>
matcher works similar to the <code>Accept</code> header. The HTTP Content Type Header
however is much less common, as it is only used in POST, PUT, PATCH requests (or
any other requests that send a HTTP Body).</p><p>The main difference however is that the client never (unless it sends malformed
data) sends wildcard MIME types, as the MIME type needs to be deterministic.
It&#x27;s typically something like <code>multipart/form-data</code>,
<code>application/x-www-form-urlencoded</code>, or <code>application/json</code>.</p><p>In ORY Oathkeeper, you can specify the matching conditions for the
<code>Content-Type</code> header as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">content_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> multipart/form</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> application/x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">www</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">form</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">urlencoded</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># OR</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> application/json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As discussed previously, if this configuration key is left empty, then all
<code>Content-Type</code> headers will match!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="error-handlers"></a>Error Handlers<a class="hash-link" href="#error-handlers" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="json"></a><code>json</code><a class="hash-link" href="#json" title="Direct link to heading">#</a></h3><p>The <code>json</code> Error Handler returns an <code>application/json</code> response type. Per
default, error messages are stripped of their details to reduce OSINT attack
surface. You can enable more detailed error messages by setting <code>verbose</code> to
<code>true</code>. As discussed in the previous section, you can define error matching
conditions under the <code>when</code> key.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json5"><pre tabindex="0" class="prism-code language-json5 codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// access-rule.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  handler: &#x27;json&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbose: true, // defaults to false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    when: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="redirect"></a><code>redirect</code><a class="hash-link" href="#redirect" title="Direct link to heading">#</a></h3><p>The <code>redirect</code> Error Handler returns a HTTP 302/301 response with a <code>Location</code>
Header. As discussed in the previous section, you can define error matching
conditions under the <code>when</code> key.</p><p>If you want to append the current url (where the error happened) to address
redirected to, You can specify <code>return_to_query_param</code> to set the name of
parameter that will hold the url.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json5"><pre tabindex="0" class="prism-code language-json5 codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// access-rule.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  handler: &#x27;json&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    to: &#x27;http://my-website/login&#x27;, // required!!</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return_to_query_param: &#x27;return_to&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    code: 301, // defaults to 302 - only 301 and 302 are supported.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    when: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When the user accesses a protected url <code>http://my-website/settings</code>, they will
be redirected to
<code>http://my-website/login?return_to=http%3A%2F%2Fmy-website%2Fsettings</code>. The
login page can use the <code>return_to</code> paramter to return user to intended page
after a successful login.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="www_authenticate"></a><code>www_authenticate</code><a class="hash-link" href="#www_authenticate" title="Direct link to heading">#</a></h3><p>The <code>www_authenticate</code> Error Handler responds with HTTP 401 and a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate" target="_blank" rel="noopener noreferrer"><code>WWW-Authenticate</code></a>
HTTP Header.</p><p>You can configure the <code>realm</code> the browser will display. The <code>realm</code> is a message
that will be displayed by the browser. Most browsers show a message like &quot;The
website says: <code>&lt;realm&gt;</code>&quot;. Using a real message is thus more appropriate than a
Realm identifier.</p><p>This error handler is &quot;exotic&quot; as WWW-Authenticate is not a common pattern in
today&#x27;s web. As discussed in the previous section, you can define error matching
conditions under the <code>when</code> key.</p><p><strong>Example</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json5"><pre tabindex="0" class="prism-code language-json5 codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// access-rule.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  handler: &#x27;json&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    realm: &#x27;Please enter your username and password&#x27;, // Defaults to `Please authenticate.`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    when: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/ory/oathkeeper/edit/master/docs/versioned_docs/version-v0.38/pipeline/error.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2020-12-09T10:22:59.000Z">12/9/2020</time></b> by <b>aeneasr</b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/oathkeeper/docs/pipeline/mutator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Mutators</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/oathkeeper/docs/configure-deploy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure and Deploy ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#error-matching" class="table-of-contents__link">Error Matching</a><ul><li><a href="#fallback" class="table-of-contents__link">Fallback</a></li><li><a href="#matchers" class="table-of-contents__link">Matchers</a></li></ul></li><li><a href="#error-handlers" class="table-of-contents__link">Error Handlers</a><ul><li><a href="#json" class="table-of-contents__link"><code>json</code></a></li><li><a href="#redirect" class="table-of-contents__link"><code>redirect</code></a></li><li><a href="#www_authenticate" class="table-of-contents__link"><code>www_authenticate</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright ¬© 2021 ORY GmbH</div></div></div></footer></div></div>
<script src="/oathkeeper/docs/assets/js/runtime~main.55f946a5.js"></script>
<script src="/oathkeeper/docs/assets/js/main.55275cf4.js"></script>
<noscript><p><img src="//sqa-web.ory.sh/np.php?idsite=2&amp;rec=1" style="border:0;" alt=""></p></noscript></body>
</html>