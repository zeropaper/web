(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[4096],{2924:function(e,t,n){"use strict";var a=n(7294).createContext(void 0);t.Z=a},5350:function(e,t,n){"use strict";var a=n(7294),r=n(2924);t.Z=function(){var e=(0,a.useContext)(r.Z);if(null==e)throw new Error('"useThemeContext" is used outside of "Layout" component. Please see https://docusaurus.io/docs/api/themes/configuration#usethemecontext.');return e}},347:function(e,t,n){"use strict";n.r(t),n.d(t,{contentTitle:function(){return m},default:function(){return N},frontMatter:function(){return h},metadata:function(){return g},toc:function(){return k}});var a=n(2122),r=n(9756),o=n(7294),i=n(3905),s=n(3300),l=n.n(s),p=n(1756),c="container_2x1S",d=function(e,t){if(!e)return 0;var n=t.findIndex((function(t){return t.indexOf(e)>-1}));return-1===n?0:n},u=function(e){var t=e.src,n=e.title,a=(0,o.useState)(""),r=a[0],i=a[1];(0,o.useEffect)((function(){var n,a,r;l()(t.replace("github.com","raw.githubusercontent.com").replace("/blob/","/")).then((function(e){return e.text()})).then((n=e,a=n.startAt,r=n.endAt,function(e){var t=e.split("\n"),n=d(a,t);n>0&&(t=["// ..."].concat(t.slice(n,-1)));var o=d(r,t);return o>0&&(t=[].concat(t.slice(0,o+1),["// ..."])),t.join("\n")})).then(i).catch(console.error)}),[]);var s="language-"+function(e){var t=e.split(".").pop();switch(t){case"jsx":return"jsx";case"tsx":return"tsx";case"ts":return"typescript";case"go":return"go";case"yaml":case"yml":return"yaml";case"js":return"javascript";case"html":return"html";case"pug":return"pug";default:return t}}(t),u='title="'+(n||function(e){var t=e.match(new RegExp("https://github.com/[^/]+/[^/]+/blob/[^/]+/(.+)","i"))||[];return t.length>=2?t[1]:e}(t))+'"';return o.createElement("div",{className:c},o.createElement(p.Z,{metastring:u,className:s,children:r}))},h={id:"integrate-nodejs",title:"Integrate with NodeJS"},m=void 0,g={unversionedId:"guides/integrate-nodejs",id:"guides/integrate-nodejs",isDocsHomePage:!1,title:"Integrate with NodeJS",description:"This page describes how to integrate different types of NodeJS apps with Ory.",source:"@site/docs/guides/integrate-nodejs.mdx",sourceDirName:"guides",slug:"/guides/integrate-nodejs",permalink:"/docs/guides/integrate-nodejs",editUrl:"https://github.com/ory/docs/edit/master/docs/docs/guides/integrate-nodejs.mdx",version:"current",lastUpdatedBy:"aeneasr",lastUpdatedAt:1621605867,formattedLastUpdatedAt:"5/21/2021",frontMatter:{id:"integrate-nodejs",title:"Integrate with NodeJS"},sidebar:"docs",previous:{title:"Install and Use the Ory CLI",permalink:"/docs/guides/ory-cli-install-use"},next:{title:"No-Code with Ory Proxy",permalink:"/docs/guides/proxy"}},k=[{value:"ExpressJS with TypeScript",id:"expressjs-with-typescript",children:[{value:"Code Integration",id:"code-integration",children:[]}]}],f={toc:k};function N(e){var t=e.components,o=(0,r.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,a.Z)({},f,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This page describes how to integrate different types of NodeJS apps with Ory.\nPlease have the ",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/ory-cli-install-use"},"Ory CLI")," installed on your system as\nwell as a ",(0,i.kt)("a",{parentName:"p",href:"/docs/get-started"},"running Ory Project")," and a\n",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/create-personal-access-token"},"Personal Access Token"),"."),(0,i.kt)("h2",{id:"expressjs-with-typescript"},"ExpressJS with TypeScript"),(0,i.kt)("p",null,"This example uses NodeJS with TypeScript support and ExpressJS to set up an app\nwith two endpoints:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/"),": can be accessed without an active Ory Session;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/public"),": can be accessed without an active Ory Session;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/protected"),": can only be accessed after registration / login - with an active\nOry Session.")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You can find this\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ory/docs/tree/master/examples/typescript-express"},"example's source code on GitHub"),"."))),(0,i.kt)("p",null,"To get started open a new terminal and set the environment variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ORY_ACCESS_TOKEN"),": Use a personal access token here;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ORY_PROJECT_URL"),': Use the Project URL which you can find on the "Services &\nAPIs" page of your project.')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# IMPORTANT - The URL MUST NOT end with a trailing slash!\nexport ORY_PROJECT_URL=...\n# e.g.\n# export ORY_PROJECT_URL=https://nostalgic-jemison-kj2qx0nhmk.projects.oryapis.com\n\nexport ORY_ACCESS_TOKEN=...\n# e.g.\n# export ORY_ACCESS_TOKEN=2123l8jJhSIYQZvfasd53YoRvcseg1\n")),(0,i.kt)("p",null,"To get started, check out the example's source code, install the node packages,\nand run the app:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/ory/docs.git\ncd docs/examples/typescript-express\nnpm i\n\n## ATTENTION ##\n# Node, similar to Firefox, does not use the Operating System Certificate store.\n# To get the self-signed SSL certificates working, we need to disable TLS Verification.\n# NEVER, EVER do this in a live system.\nNODE_TLS_REJECT_UNAUTHORIZED=0 npm start\n")),(0,i.kt)("p",null,"Open another terminal and copy set the ",(0,i.kt)("inlineCode",{parentName:"p"},"ORY_ACCESS_TOKEN")," env var to your\nPersonal Access Token:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"export ORY_ACCESS_TOKEN=...\n")),(0,i.kt)("p",null,"Next, run the Ory Proxy with"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--protect-path-prefix /protected"),": only the path /protected needs a valid Ory\nSession;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--port 4000"),": the port on which the proxy should listen on;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/"),": the host and port of the NodeJS app you are\nprotecting.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"ory proxy local \\\n  --protect-path-prefix /protected \\\n  --port 4000 \\\n  http://localhost:8000/\n")),(0,i.kt)("p",null,"Your operating system will prompt you for your administrative password. The Ory\nProxy sets up a temporary SSL certificate in your operating system's certificate\nstore to enable HTTPS integration."),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The registration of the self-signed SSL certificate works only in Chrome and\nSafari but not yet in Firefox. Also, programming languages like Golang, NodeJS,\nand others often do not respect the operating system certificate store. In those\ncases, you must disable TLS verification. This is not an issue in production!"))),(0,i.kt)("p",null,"To see what the app can do, open it at the original endpoints:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://localhost:8000/public"},"localhost:8000/public")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://localhost:8000/protected"},"localhost:8000/protected"))),(0,i.kt)("p",null,"The second URL ",(0,i.kt)("inlineCode",{parentName:"p"},"/protected")," will greet you with an error because no Ory Session\nis available."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"NodeJS route is not available without authentication",src:n(1594).Z})),(0,i.kt)("p",null,"However, if you open the URL through the proxy at\n",(0,i.kt)("a",{parentName:"p",href:"https://localhost:4000/protected"},"https://localhost:4000/protected"),", your\nbrowser will be redirected to a login screen! Once you created an account or\nsigned in, the application will show information about the session:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"NodeJS route is not available without authentication",src:n(7193).Z})),(0,i.kt)("h3",{id:"code-integration"},"Code Integration"),(0,i.kt)("p",null,"To get the app integrated with Ory, we use the following ",(0,i.kt)("inlineCode",{parentName:"p"},"npm")," dependencies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@ory/client"},(0,i.kt)("inlineCode",{parentName:"a"},"@ory/client"))," contains the Ory\nSDK. While not needed, the app includes an example of how to set up the SDK\nand use it;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/dotenv"},(0,i.kt)("inlineCode",{parentName:"a"},"dotenv"))," loads environment variables\nfrom a ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/express-jwt"},(0,i.kt)("inlineCode",{parentName:"a"},"express-jwt"))," is an express\nmiddleware for JWTs;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/jwks-rsa"},(0,i.kt)("inlineCode",{parentName:"a"},"jwks-rsa"))," a library to load the\ncryptographic keys for verifying JWTs using a remote URL.")),(0,i.kt)("p",null,"Let's take a look at the annotated code!"),(0,i.kt)(u,{lang:"js",link:"https://github.com/ory/docs/blob/master/examples/typescript-express/src/index.ts",src:"https://raw.githubusercontent.com/ory/docs/master/examples/typescript-express/src/index.ts",mdxType:"CodeFromRemote"}),(0,i.kt)("p",null,"Great! You've made it! Integrating Ory is easy and straight forward. There are\nmany more things to come, and we are excited to have you on board!"))}N.isMDXComponent=!0},3300:function(e,t){"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},7193:function(e,t,n){"use strict";t.Z=n.p+"assets/images/proxy-auth-7ecdb74c8cd76872fdef23df11764e20.png"},1594:function(e,t,n){"use strict";t.Z=n.p+"assets/images/proxy-unauth-310f4200059e412511bc832ae67f4442.png"}}]);