"use strict";(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[6712],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return y}});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),y=o,h=d["".concat(s,".").concat(y)]||d[y]||u[y]||i;return t?r.createElement(h,a(a({ref:n},c),{},{components:t})):r.createElement(h,a({ref:n},c))}));function y(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var p=2;p<i;p++)a[p]=t[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},69417:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var r=t(87462),o=t(63366),i=(t(67294),t(3905)),a=["components"],l={id:"proxy",title:"Using the Ory Proxy"},s=void 0,p={unversionedId:"guides/proxy",id:"guides/proxy",isDocsHomePage:!1,title:"Using the Ory Proxy",description:"The Ory Proxy is a powerful tool which authenticates users, converts session",source:"@site/docs/guides/proxy.mdx",sourceDirName:"guides",slug:"/guides/proxy",permalink:"/docs/guides/proxy",editUrl:"https://github.com/ory/docs/edit/master/docs/docs/guides/proxy.mdx",tags:[],version:"current",lastUpdatedBy:"hackerman",lastUpdatedAt:1630486355,formattedLastUpdatedAt:"9/1/2021",frontMatter:{id:"proxy",title:"Using the Ory Proxy"},sidebar:"docs",previous:{title:"Other Integrations",permalink:"/docs/start-building/other-languages"},next:{title:"Bring Your Own UI",permalink:"/docs/guides/bring-your-user-interface"}},c=[{value:"Concepts",id:"concepts",children:[{value:"URL Structure",id:"url-structure",children:[],level:3},{value:"Zero Trust",id:"zero-trust",children:[],level:3}],level:2},{value:"Ory Proxy for Local Development",id:"ory-proxy-for-local-development",children:[],level:2},{value:"Ory Proxy for Production",id:"ory-proxy-for-production",children:[{value:"Running on a NodeJS PaaS (Vercel, Netlify, Gatsby Cloud, ...)",id:"running-on-a-nodejs-paas-vercel-netlify-gatsby-cloud-",children:[],level:3},{value:"Running on a VM",id:"running-on-a-vm",children:[],level:3},{value:"Running in Docker",id:"running-in-docker",children:[],level:3},{value:"Kubernetes",id:"kubernetes",children:[],level:3}],level:2},{value:"Troubleshooting",id:"troubleshooting",children:[],level:2}],u={toc:c};function d(e){var n=e.components,t=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Ory Proxy is a powerful tool which authenticates users, converts session\ninto a JSON Web Token, and ensures that cookies and URLs are properly\nconfigured."),(0,i.kt)("p",null,"Using Ory Cloud without the Ory Proxy is currently not encouraged, unless you\nare writing a mobile application or are only interacting with Ory Cloud's Admin\nAPIs."),(0,i.kt)("p",null,"If you haven't already, please\n",(0,i.kt)("a",{parentName:"p",href:"/docs/start-building/ory-cli-install-use"},"install the Ory CLI")," on your\ndevelopment machine or server."),(0,i.kt)("h2",{id:"concepts"},"Concepts"),(0,i.kt)("p",null,"Before heading into the concrete examples, let's look at some of the Ory Proxy's\nconcepts."),(0,i.kt)("h3",{id:"url-structure"},"URL Structure"),(0,i.kt)("p",null,"The Ory Proxy mirrors Ory Cloud's APIs and UIs under the ",(0,i.kt)("inlineCode",{parentName:"p"},"/.ory")," path. If you\nwere to call, for example, the URL\n",(0,i.kt)("inlineCode",{parentName:"p"},"https://<your-project-slug>.projects.oryapis.com/ui/login"),", the equivalent\nproxied URL would be ",(0,i.kt)("inlineCode",{parentName:"p"},"https://<proxy-host>/.ory/ui/login"),"."),(0,i.kt)("p",null,"The Ory Proxy has a few shorthand URLs which you can use to initiate\nself-service flows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/.ory/init/login")," initiates the self-service login flow."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/.ory/init/registration")," initiates the self-service registration flow."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/.ory/init/recovery")," initiates the self-service recovery flow."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/.ory/init/verification")," initiates the self-service verification flow."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/.ory/init/settings")," initiates the self-service settings flow.")),(0,i.kt)("p",null,"If you redirect or link the user to one of those paths, the login, registration,\n... flow will be initiated:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<a href="/.ory/init/login">Log in</a>\n')),(0,i.kt)("p",null,"You can also append a ",(0,i.kt)("inlineCode",{parentName:"p"},"return_to")," query parameter so that the user ends up at\nthat URL. Please keep in mind that the domain MUST be an allow-listed URL in the\nOry Cloud Project configuration!"),(0,i.kt)("p",null,"The return_to URL must include the protocol and domain! Relative URLs are not\npossible."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<a href="/.ory/init/login?return_to=https://localhost:4000/my-url">Log in</a>\n')),(0,i.kt)("h3",{id:"zero-trust"},"Zero Trust"),(0,i.kt)("p",null,"The Ory Proxy translates any known Ory credentials (e.g. Ory Session Token or\nOry Session Cookie) to a JSON Web Token. Assuming the user calls the Ory Proxy\nwith a valid Ory Session Cookie"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /some-path\nHost: localhost:4000\nCookie: ory_session_jollyproskuriakovaxe98qw5t8g=MTYyNzU1OTgyNHxEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJR3RGU1d4dlUwOXVSR2w1UjJONmFVRlhaWEIxWVhCVlNHWlZOVTQxWWtGMnwhbFZh8BCCQ3tMemDczrB9-epefXl1E7whiChUt62LuA==\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.164 Safari/537.36\n...\n")),(0,i.kt)("p",null,"the Ory Proxy resolves that session and converts it to a JSON Web Token which is\nincluded in the HTTP Request's ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization"),' Header which is made to the\n"upstream" (the URL which the Ory Proxy is protecting). The session cookie will\nstill be included in the request, in case that you need it to generate a logout\nURL for example.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'GET /some-path\nHost: <your-application>:3000\nAuthorization: eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2Mjc1NjAxMjQsImlhdCI6MTYyNzU2MDA2NCwiaXNzIjoiaHR0cHM6Ly9qb2xseS1wcm9za3VyaWFrb3ZhLXhlOThxdzV0OGcucHJvamVjdHMub3J5YXBpcy5jb20iLCJqdGkiOiJlYWFlYzI0My0yY2IwLTQ2OGEtYmViZS0xYTAzNDkyNDJjZjAiLCJuYmYiOjE2Mjc1NjAwNjQsInNlc3Npb24iOnsiaWQiOiJiNzNkN2RjNC1mNTY1LTRmZWEtOTUxZS04YzIzZWUwNTc4M2YiLCJhY3RpdmUiOnRydWUsImV4cGlyZXNfYXQiOiIyMDIxLTA3LTMwVDEyOjAxOjAyLjk2NjYzWiIsImF1dGhlbnRpY2F0ZWRfYXQiOiIyMDIxLTA3LTI5VDEyOjAxOjAzLjAyNDM2NVoiLCJpc3N1ZWRfYXQiOiIyMDIxLTA3LTI5VDEyOjAxOjAyLjk2NjY1MloiLCJpZGVudGl0eSI6eyJpZCI6IjBmMGM5YmVjLTZiNjgtNDdmMy1iNjJiLTc3NTBmMDY1MzU5YyIsInNjaGVtYV9pZCI6ImRlZmF1bHQiLCJzY2hlbWFfdXJsIjoiaHR0cHM6Ly9qb2xseS1wcm9za3VyaWFrb3ZhLXhlOThxdzV0OGcucHJvamVjdHMub3J5YXBpcy5jb20vYXBpL2tyYXRvcy9wdWJsaWMvc2NoZW1hcy9kZWZhdWx0Iiwic3RhdGUiOiJhY3RpdmUiLCJzdGF0ZV9jaGFuZ2VkX2F0IjoiMjAyMS0wNy0yOVQxMjowMTowMi44NDQ0NzJaIiwidHJhaXRzIjp7ImVtYWlsIjoiZGV2K2RvY3NAb3J5LnNoIiwiZmlyc3RuYW1lIjoiT3J5IERvY3MiLCJ2ZWdldGVyaWFuIjp0cnVlfSwidmVyaWZpYWJsZV9hZGRyZXNzZXMiOlt7ImlkIjoiNjRiM2YyNzAtNzBmYy00OGI4LTg3MDQtODA4NWM3ODMzNjJiIiwidmFsdWUiOiJkZXYrZG9jc0Bvcnkuc2giLCJ2ZXJpZmllZCI6ZmFsc2UsInZpYSI6ImVtYWlsIiwic3RhdHVzIjoic2VudCIsInZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyMS0wNy0yOVQxMjowMTowMi44ODg1NjJaIiwidXBkYXRlZF9hdCI6IjIwMjEtMDctMjlUMTI6MDE6MDIuODg4NTYyWiJ9XSwicmVjb3ZlcnlfYWRkcmVzc2VzIjpbeyJpZCI6IjUyNmEyYjI1LTJiOWEtNDQ1Yi05ODJkLTk3ODYyZDliYmM5YiIsInZhbHVlIjoiZGV2K2RvY3NAb3J5LnNoIiwidmlhIjoiZW1haWwiLCJjcmVhdGVkX2F0IjoiMjAyMS0wNy0yOVQxMjowMTowMi44OTc0MDdaIiwidXBkYXRlZF9hdCI6IjIwMjEtMDctMjlUMTI6MDE6MDIuODk3NDA3WiJ9XSwiY3JlYXRlZF9hdCI6IjIwMjEtMDctMjlUMTI6MDE6MDIuODc3NDE3WiIsInVwZGF0ZWRfYXQiOiIyMDIxLTA3LTI5VDEyOjAxOjAyLjg3NzQxN1oifX0sInN1YiI6IjBmMGM5YmVjLTZiNjgtNDdmMy1iNjJiLTc3NTBmMDY1MzU5YyJ9.6vvdyNkNce39W8WPKwF5QUTOlBjF5VW6Xl3QzYHU9M1riiDVgQ4rK8XHEqcjhAQcis8EIbRm7K0UuLNGwKsKzQ",\nCookie: ory_session_jollyproskuriakovaxe98qw5t8g=MTYyNzU1OTgyNHxEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJR3RGU1d4dlUwOXVSR2w1UjJONmFVRlhaWEIxWVhCVlNHWlZOVTQxWWtGMnwhbFZh8BCCQ3tMemDczrB9-epefXl1E7whiChUt62LuA==\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.164 Safari/537.36\n...\n')),(0,i.kt)("p",null,"We strongly encourage you to validate the JSON Web Token using the Ory Proxy's\npublic key. The public key is available at ",(0,i.kt)("inlineCode",{parentName:"p"},"/.ory/proxy/jwks.json"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'$ curl -sk https://<proxy-host>/.ory/proxy/jwks.json | jq\n{\n  "keys": [\n    {\n      "use": "sig",\n      "kty": "EC",\n      "kid": "f8f2e6ff-0480-4343-9dee-0d2a463146dc",\n      "crv": "P-256",\n      "alg": "ES256",\n      "x": "Say2LSWvHxUnyxuW5lxsTFkKopZq402eH4YqcRiBgvA",\n      "y": "7XaYgYsW-Mjb5qIq47LxyaPHjPZfRHRnnfir8aqd9BU"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"If you do now know how to validate a JSON Web Token, head over to the\n",(0,i.kt)("a",{parentName:"p",href:"/docs/start-building/server-side-web-app"},"Server-Side Web App")," documentation\npage."),(0,i.kt)("p",null,"Using the public key, you can validate and decode the JSON Web Token, which\nincludes all the session and identity information linked to the Ory Session\nCookie:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "exp": 1627560124,\n  "iat": 1627560064,\n  "iss": "https://<project-slug>.projects.oryapis.com",\n  "jti": "eaaec243-2cb0-468a-bebe-1a0349242cf0",\n  "nbf": 1627560064,\n  "session": {\n    "id": "b73d7dc4-f565-4fea-951e-8c23ee05783f",\n    "active": true,\n    "expires_at": "2021-07-30T12:01:02.96663Z",\n    "authenticated_at": "2021-07-29T12:01:03.024365Z",\n    "issued_at": "2021-07-29T12:01:02.966652Z",\n    "identity": {\n      "id": "0f0c9bec-6b68-47f3-b62b-7750f065359c",\n      "schema_id": "default",\n      "schema_url": "https://<project-slug>.projects.oryapis.com/api/kratos/public/schemas/default",\n      "state": "active",\n      "state_changed_at": "2021-07-29T12:01:02.844472Z",\n      "traits": {\n        "email": "dev+docs@ory.sh",\n        "firstname": "Ory Docs",\n        "vegeterian": true\n      },\n      "verifiable_addresses": [\n        {\n          "id": "64b3f270-70fc-48b8-8704-8085c783362b",\n          "value": "dev+docs@ory.sh",\n          "verified": false,\n          "via": "email",\n          "status": "sent",\n          "verified_at": null,\n          "created_at": "2021-07-29T12:01:02.888562Z",\n          "updated_at": "2021-07-29T12:01:02.888562Z"\n        }\n      ],\n      "recovery_addresses": [\n        {\n          "id": "526a2b25-2b9a-445b-982d-97862d9bbc9b",\n          "value": "dev+docs@ory.sh",\n          "via": "email",\n          "created_at": "2021-07-29T12:01:02.897407Z",\n          "updated_at": "2021-07-29T12:01:02.897407Z"\n        }\n      ],\n      "created_at": "2021-07-29T12:01:02.877417Z",\n      "updated_at": "2021-07-29T12:01:02.877417Z"\n    }\n  },\n  "sub": "0f0c9bec-6b68-47f3-b62b-7750f065359c"\n}\n')),(0,i.kt)("h2",{id:"ory-proxy-for-local-development"},"Ory Proxy for Local Development"),(0,i.kt)("p",null,"The Ory Proxy works great on local machines (",(0,i.kt)("inlineCode",{parentName:"p"},"localhost"),"). It is able to\nregister SSL certificates in your operating system's credential store when\nstarting up, allowing for an easy and secure way to start development."),(0,i.kt)("p",null,"Assuming you are running, for example, a NodeJS app on port 3000, you would\npoint the Ory Proxy to that URL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"export ORY_ACCESS_TOKEN=<your personal access token here>\nory proxy local http://localhost:3000\n")),(0,i.kt)("p",null,"For other CLI flags which, for example, disable the auto-opening of the URL in\nthe browser, run ",(0,i.kt)("inlineCode",{parentName:"p"},"ory help proxy local")," or head over to the\n",(0,i.kt)("a",{parentName:"p",href:"/docs/cli/ory-proxy-local"},"Ory Proxy Local Reference"),"."),(0,i.kt)("h2",{id:"ory-proxy-for-production"},"Ory Proxy for Production"),(0,i.kt)("p",null,"The Ory Proxy is also capable of protecting remote and production environments.\nAlternatively you can also use\n",(0,i.kt)("a",{parentName:"p",href:"/docs/start-building/deploy-auth-production"},"DNS CNAME"),"."),(0,i.kt)("p",null,"Using the Ory Proxy in production works similar to the local development flow,\nwith a few differences:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The Ory Proxy will not install any SSL certificates. You are responsible for\nsetting up HTTPS."),(0,i.kt)("li",{parentName:"ol"},"You must specify the URL where the proxy is running.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"export ORY_ACCESS_TOKEN=<your personal access token here>\nory proxy production http://localhost:3000 https://my-domain.com\n")),(0,i.kt)("p",null,"For other CLI flags which, for example, disable the auto-opening of the URL in\nthe browser, run ",(0,i.kt)("inlineCode",{parentName:"p"},"ory help proxy production")," or head over to the\n",(0,i.kt)("a",{parentName:"p",href:"/docs/cli/ory-proxy-local"},"Ory Proxy Production Reference"),"."),(0,i.kt)("h3",{id:"running-on-a-nodejs-paas-vercel-netlify-gatsby-cloud-"},"Running on a NodeJS PaaS (Vercel, Netlify, Gatsby Cloud, ...)"),(0,i.kt)("p",null,"If you deploy your application on a PaaS such as Vercel, Gatsby Cloud, or\nNetlify the best option is to install the Ory CLI using NPM\n(",(0,i.kt)("inlineCode",{parentName:"p"},"npm i --save @ory/cli"),") and run it as part of your NPM start script:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "scripts": {\n    "start": "npm-run-all -p start:*",\n    "start:proxy": "ory proxy local --port $PORT http://127.0.0.1:3000 https://your-domain.com",\n    "start:server": "node your-entrypoint.js"\n  }\n}\n')),(0,i.kt)("p",null,"Here we are assuming that your server is running on port 3000. If it is running\non a different port, replace the port number in ",(0,i.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:3000"),"."),(0,i.kt)("p",null,"Additionally we are assuming that your PaaS is exposing the port on which your\napp is running at the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"PORT")," and that it is actually\nexecuting ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run start")," and not just using static files!"),(0,i.kt)("h3",{id:"running-on-a-vm"},"Running on a VM"),(0,i.kt)("p",null,"If you are deploying on a VM, Virtual or Dedicated Server using the Ory Proxy is\neasy! Just run your application server and the proxy in parallel. Assuming you\nare using NodeJS to run your server on port 3000, and are exposing web traffic\nat port 8080, use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ory proxy local --port 8080 http://127.0.0.1:3000 https://your-domain.com &\n\n# This should be your server command\nnode your-entrypoint.js\n\n# Could also be something like:\n#   go run main.go\n#   php index.php\n#   ...\n")),(0,i.kt)("h3",{id:"running-in-docker"},"Running in Docker"),(0,i.kt)("p",null,"One option is to add both the Ory Proxy and your service to a Docker container."),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Running two processes in one Docker Container is problematic as Docker will only\nwatch the process running in the foreground. If the process in the background\ncrashes, Docker will not be notified. To get a more stable system in place,\nplease follow\n",(0,i.kt)("a",{parentName:"p",href:"https://docs.docker.com/config/containers/multi-service_container/"},"Run multiple services in a container"),"."),(0,i.kt)("p",{parentName:"div"},"For simplicity we have chosen to run the Ory Proxy as a background task here!"))),(0,i.kt)("p",null,"To run the Ory Proxy alongside your application, create a file called\n",(0,i.kt)("inlineCode",{parentName:"p"},"entrypoint.sh")," with a content along the lines of:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"#!/bin/bash\nset -e\n\n# This assumes that your server is running on port 3000. If it is running on a different port,\n# change the `3000` to the port where your server is running at!\nory proxy local --port 8080 http://127.0.0.1:3000 https://your-domain.com &\n\n# This should be your server command\nnode your-entrypoint.js\n# Could also be something like:\n#   go run main.go\n#   php index.php\n#   ...\n")),(0,i.kt)("p",null,"Then, add the script to your Dockerfile and run it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-Dockerfile"},'# ...\n\nEXPOSE 8080\n\nCOPY ./docker-entrypoint.sh /\nENTRYPOINT ["/docker-entrypoint.sh"]\n')),(0,i.kt)("h3",{id:"kubernetes"},"Kubernetes"),(0,i.kt)("p",null,"Adding a Helm Chart for the Ory Proxy is on the roadmap, which would allow\nrunning the Ory Proxy either as a Service, Ingress, or Side Car!"),(0,i.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("p",null,"If you run get an error while working with the Ory Proxy or Ory CLI , make sure\nyou are on the latest version."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"For\n",(0,i.kt)("a",{parentName:"li",href:"https://www.ory.sh/docs/start-building/ory-cli-install-use#install-on-macos"},"brew (MacOs)"),"\nuse ",(0,i.kt)("inlineCode",{parentName:"li"},"brew upgrade ory"),","),(0,i.kt)("li",{parentName:"ul"},"For\n",(0,i.kt)("a",{parentName:"li",href:"https://www.ory.sh/docs/start-building/ory-cli-install-use#install-on-windows"},"scoop (Win)"),"\nuse ",(0,i.kt)("inlineCode",{parentName:"li"},"scoop update ory"))),(0,i.kt)("p",null,"to update to the latest version. The Ory CLI will autoupdate in the near future."))}d.isMDXComponent=!0}}]);